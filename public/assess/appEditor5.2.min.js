/*(c) 2019 Martin Ridgeway <martin@ridgeway.io> MIT license * A very special thanks to Anna Otterstad and Lee Gaskell - who gave their time generously to help test the app*/
window.addEventListener("load",function(){!function(){"use strict";var w={editorIsOpen:{record:!1,rubric:!1,grader:!1},db:{records:!1,rubrics:!1,students:!1,snippets:!1},appEditRecords:{tempStudent:{stId:"",stNme:"",stCls:""},labelIndex:0,tempStudentRecords:[],loadedRubric:[]},recordsIndex:[],studentData:[],table_Id:"",table_lookup:{},tableObj:{},rubricsIndex:{},sharedRubricsIndex:{},snippets:[],grader:{noRubricCommentsOnly:!1,loadedRubric:[],snippets:[],rubric:[],tempRecord:{rubricRef:"",context:"Assignment",activeSections:[]}}};function _(e){return document.getElementById(e)}function c(){firebase.auth().signOut()}function n(e,t,n){var r,a=$(e),c=firebase.database().ref().child("assessments/"+t+"/savedRubricsIndex/").push().key,d=ce(a),s={};s["assessments/"+t+"/savedRubricsIndex/"+c]=d,s["assessments/"+t+"/savedRubrics/"+c]=a,!0===n&&(s["sharedRubrics/rubricsIndex/"+(r=firebase.database().ref().child("sharedRubrics/rubricsIndex/").push().key)]=d,s["sharedRubrics/rubrics/"+r]=a),firebase.database().ref().update(s,function(e){e?(p(e),g("d",e),tn("editRubric")):ae(c,d,r)})}function t(e,t){!0===_("shareThisRubric").checked?window.mscConfirm({title:"",subtitle:"You have opted to share this rubric with all users. Is that correct?",cancelText:"Cancel",onOk:function(){n(e,t,!0)},onCancel:function(){}}):n(e,t,!1)}function d(e,t,n,r){var a,c=$(e),d=ce(c),s={};s["assessments/"+n+"/savedRubricsIndex/"+t]=d,s["assessments/"+n+"/savedRubrics/"+t]=c,!0===r&&(s["sharedRubrics/rubricsIndex/"+(a=firebase.database().ref().child("sharedRubrics/rubricsIndex/").push().key)]=d,s["sharedRubrics/rubrics/"+a]=c),firebase.database().ref().update(s,function(e){e?(p(e),g("d",e),tn("editRubric")):ae(t,d,a)})}function e(n){var e=firebase.auth().currentUser.uid,t={};t["assessments/"+e+"/savedRubricsIndex/"+n]=null,t["assessments/"+e+"/savedRubrics/"+n]=null,firebase.database().ref().update(t,function(e){var t;e?p(e):(t=n,delete w.rubricsIndex[t],w.appEditRecords.loadedRubric=[],Xt("ruLoadSelected"),Z(),te(),Je())})}function o(n){var t={},r=firebase.auth().currentUser.uid;n.forEach(function(e){t["assessments/"+r+"/recordsIndex/"+e]=null,t["assessments/"+r+"/records/"+e]=null}),firebase.database().ref().update(t,function(e){return e?(p(e),void g("n",e)):(n.forEach(function(e){-1!==(t=w.recordsIndex.map(function(e){return e.recordKey}).indexOf(e))&&w.recordsIndex.splice(t,1)}),g("o"),void Rn());var t})}function l(c,d){var s,e=firebase.auth().currentUser.uid;firebase.database().ref("assessments/"+e+"/records/"+c).once("value").then(function(e){var t,n,r,a;null!==(s=e.val())&&(s.recordKey=c,n=d,r=ln(t=s),a=t.studentData.stCls+"_"+t.studentData.stNme+"_"+t.studentData.stId+"_"+t.context+".pdf",pdfMake.createPdf(r).download(a),cn(n))},function(e){p(e)})}function u(e,r){var c,d,t=firebase.auth().currentUser.uid,s=[],i=e.length;e.forEach(function(n){firebase.database().ref("assessments/"+t+"/records/"+n).once("value").then(function(e){var a,t;null!==(d=e.val())&&(d.recordKey=n,(c={}).content=ln(d),c.name=d.studentData.stCls+"_"+d.studentData.stNme+"_"+d.studentData.stId+"_"+d.context+"_"+d.timeStamp+".pdf",s.push(c),s.length===i&&(a=r,t=[],s.forEach(function(e){var r;t.push((r=e,new window.Promise(function(t){var e,n;e=r.content,n=pdfMake.createPdf(e),new window.Promise(function(t){n.getBase64(function(e){t(e)})}).then(function(e){r.content={},r.content.base64=e,t(r)})})))}),window.Promise.all(t).then(function(e){var t,n,r;t=e,n=a,r=new JSZip,t.forEach(function(e){r.file(e.name,e.content.base64,{base64:!0})}),r.generateAsync({type:"blob"}).then(function(e){window.saveAs(e,"Record_downloads.zip"),cn(n)})})))},function(e){p(e)})})}function h(){var n,r={};w.appEditRecords.tempStudentRecords.length&&(n=firebase.auth().currentUser.uid,w.appEditRecords.tempStudentRecords.forEach(function(e){var t;e.hasOwnProperty("null_marked_for_deletion")?!0===e.null_marked_for_deletion&&(r["assessments/"+n+"/recordsIndex/"+e.recordKey]=null,r["assessments/"+n+"/records/"+e.recordKey]=null):(r["assessments/"+n+"/recordsIndex/"+e.recordKey]={context:(t=e).context,studentData:t.studentData,timeStamp:t.timeStamp},r["assessments/"+n+"/records/"+e.recordKey]=function(e){var t={};t.context=e.context,t.feedback=e.feedback,t.studentData=e.studentData,t.timeStamp=e.timeStamp,e.hasOwnProperty("noRubric")&&!0===e.noRubric?(t.noRubric=!0,t.noRubricScore=e.noRubricScore):(t.comments=e.comments,t.scores=e.scores,t.sectionNames=e.sectionNames);return t}(e))}),firebase.database().ref().update(r,function(e){return e?(p(e),void g("a",e)):(function(){var e,t,n,r;for(r=w.appEditRecords.tempStudentRecords.length-1;0<=r;r--)t=w.appEditRecords.tempStudentRecords[r],-1!==(e=w.recordsIndex.map(function(e){return e.recordKey}).indexOf(t.recordKey))&&(t.hasOwnProperty("null_marked_for_deletion")?!0===t.null_marked_for_deletion&&w.recordsIndex.splice(e,1):(n={stCls:t.studentData.stCls,stId:t.studentData.stId,stNme:t.studentData.stNme,context:t.context,recordKey:t.recordKey,timeStamp:t.timeStamp},w.recordsIndex[e]=n))}(),g("r"),Rn(),void Ie())}))}function r(){var e;!1===w.db.students&&(e=firebase.auth().currentUser.uid,firebase.database().ref("assessments/"+e+"/studentData").once("value").then(function(e){w.db.students=!0,w.studentData=e.val()||[],it(),mn(),!1===w.db.snippets&&a(),rn()},function(e){p(e)}))}function p(e){var t,n;"PERMISSION_DENIED"===e.code&&((t=firebase.auth().currentUser)?((n={})["newUser/spk/"+t.uid]=t.displayName,firebase.database().ref().update(n).then(c())):c())}function a(){var e,t=firebase.auth().currentUser.uid;!1===w.db.rubrics?(e=t,firebase.database().ref("assessments/"+e+"/savedRubricsIndex").once("value").then(function(e){w.db.rubrics=!0,w.rubricsIndex=e.val()||{},a(),R(w.rubricsIndex)||(en("ruLoadSelected"),te()),pn()},function(e){p(e)})):firebase.database().ref("assessments/"+t+"/snippets").once("value").then(function(e){w.db.snippets=!0,w.snippets=e.val()||[],Ye(),_("snptsTbd").addEventListener("click",Xe,{capture:!1,passive:!0}),_("ac_sn_save").addEventListener("click",Qe,{capture:!1,passive:!0}),_("ac_sn_add").addEventListener("click",Ge,{capture:!1,passive:!0}),_("ac_sn_dis").addEventListener("click",$e,{capture:!1,passive:!0}),_("snptsTbd").addEventListener("paste",E,!1)},function(e){p(e)})}function s(e){var t=firebase.auth().currentUser.uid,a={timeStamp:e.timeStamp,context:e.context,studentData:e.studentData},c=firebase.database().ref().child("assessments/"+t+"/recordsIndex/").push().key,n={};n["assessments/"+t+"/recordsIndex/"+c]=a,n["assessments/"+t+"/records/"+c]=e,firebase.database().ref().update(n,function(e){return e?(p(e),void g("a",e)):(g("s"),!0===w.db.records&&(t=c,r={stCls:""+(n=a).studentData.stCls,stId:""+n.studentData.stId,stNme:""+n.studentData.stNme,context:""+n.context,recordKey:""+t,timeStamp:[n.timeStamp].slice(0)[0]},w.recordsIndex.push(r),Rn()),void function(){var e,t;for(_("datgEntry").querySelectorAll("select").forEach(function(e){e.selectedIndex=0,_(e.id.substring(0,e.id.lastIndexOf("-")+1)+"3").textContent=""}),w.grader.tempRecord.ssId="",w.grader.tempRecord.ssName="",e=0;e<w.grader.tempRecord.scores.length;e++)for(Ee("gj"+e,e),w.grader.tempRecord.comments[e]="",_("gk"+e).textContent="",t=0;t<w.grader.tempRecord.scores[e].length;t++)w.grader.tempRecord.scores[e][t]=[];Bt(),!0!==w.grader.noRubricCommentsOnly&&Xt("gradeActions")}());var t,n,r})}function i(e,n){firebase.database().ref("assessments/"+e+"/recordsIndex").once("value").then(function(e){var t=je(e.val());w.db.records=!0,Sn(n,!0),_("mainMenu").addEventListener("click",un,{capture:!1,passive:!0}),_("mainMenu").addEventListener("click",kt,{capture:!1,passive:!0}),en("contentsBox"),en("leRecords"),en("leStudents"),en("leRubrics"),en("leSnippets"),en("leGRADER"),!1===t&&(w.recordsIndex=[]),Be(),fn()},function(e){!function(e,t,n){var r,a;if("PERMISSION_DENIED"!==n.code)return;(r=firebase.auth().currentUser)?(Sn(e,t),(a={})["newUser/spk/"+r.uid]=r.displayName,firebase.database().ref().update(a).then(window.setTimeout(c,7e3))):c()}(n,!1,e)})}function m(){i(firebase.auth().currentUser.uid,firebase.auth().currentUser.displayName.split(" ")[0].replace(/(?:^|\s)\S/g,function(e){return e.toUpperCase()}))}function g(e,t){var n={a:"Data could not be saved.\n"+t,b:"Snippets have been updated!",c:""+t,d:"Rubric could not be created.\n"+t,e:"Rubric successfully saved!",ee:"Rubric is now being shared!",f:"Please select an existing rubric to load.",g:"A section with that name already exists!",h:"Please choose a valid name!",i:"Student information has been updated!",j:"ID numbers must be unique within each class!",k:"Some fields are missing!",l:"File requires all 3 headers: 'class', 'id' and 'name'.",m:"Not a (utf-8) .csv file!",n:"Data could not be found.\n"+t,o:"Record(s) deleted!",p:"Please select at least one record to edit.",q:"The class MUST be defined!",r:"Record changes were saved!",s:"Record was saved!",t:"Please choose a student!",u:"Please choose a score for each criteria.",v:"No relevant snippets available!",w:"Please specify the context!",x:"Please choose at least ONE section to grade!",y:"Cannot load the selected rubric\n"+t,z:"Given score exceeds the maximum score!"}[e]||"Error.";window.mscAlert({title:"",subtitle:n})}function v(e){var t=new RegExp("<div>","g");return null!==e?(_(e).innerHTML=_(e).innerHTML.replace(t," <div>"),N(_(e).textContent)):""}function f(e){return e.replace(/\s+/g,"")}function b(e){return e.replace(/[\s\t]+$/,"")}function D(e){for(var t=[],n=e.length,r=0;r<n;r++){for(var a=r+1;a<n;a++)e[r]===e[a]&&(a=++r);t.push(e[r])}return t}function L(e){for(;e.hasChildNodes();){for(;e.lastChild.hasChildNodes();)e.lastChild.removeChild(e.lastChild.lastChild);e.removeChild(e.lastChild)}}function C(e,t){return Object.keys(e)[Object.values(e).indexOf(t)]}function E(e){var t;e.preventDefault(),t=(e.originalEvent||e).clipboardData.getData("text/plain").replace(/(<([^>]+)>)/gi,""),document.execCommand("insertText",!1,t)}function x(e){return Number(e.replace(/[^0-9\.]/gim,"").replace(/[\s\t]+$/,""))}function R(e){return null===e||("object"!=typeof e||0===Object.keys(e).length)}function N(e){return e.replace(/\s+/g," ").replace(/^\s+|\s+$/g,"")}function k(e){return e=e.replace(/[^a-zA-Z\0-9\-\u3130-\u318F\uAC00-\uD7AF\_]/gim,"_").replace(/\s/g,"_")}function S(e,t){var n=Number(x(_(e).value)),r=Number(x(_(t).value)),a=["",""];return NaN!==n&&NaN!==r&&(a[0]=""+n,a[1]=""+r),r<n&&(g("z"),a[0]="error"),a}function y(){w.editorIsOpen.rubric=!0,w.appEditRecords.loadedRubric=[],_("ac_ru_del").style.display="none",Xt("ruCreateNew"),Xt("ruLoadSelected"),Xt("ruLoadChkBoxes"),en("ruNewRubricName"),_("ruNewSaveBtn").addEventListener("click",I,{capture:!1,passive:!0}),_("ruNewExitBtn").addEventListener("click",O,{capture:!1,passive:!0})}function I(){var e=_("ruEnterNewName").value;""!==e?(w.editorIsOpen.rubric=!0,_("ruNameNewtxt").value=e,en("ruNameCurrent"),en("sectionInputWrapper"),en("rubricActions"),hn()):g("h")}function O(){w.editorIsOpen.rubric=!1,_("ruEnterNewName").value="",en("ruCreateNew"),Xt("ruLoadSelected"),en("ruLoadChkBoxes"),hn(),w.rubricsIndex.length&&en("ruLoadSelected")}function A(){for(var e,t=[],n=0;n<=5;n++){e=[];for(var r=0;r<=6;r++)e.push("");t.push(e)}return t}function j(){var e=w.tableObj[w.table_Id];return null==e?A():e}function B(e){w.tableObj[w.table_Id]=e}function T(e,t,n){for(var r=1;r<=t;r++)e.appendChild(function(e,t){var n=document.createElement("tr");n.setAttribute("id","hr-"+e+"-"+w.table_Id);for(var r=0;r<=t;r++){var a,c,d,s,i,o,l,u=document.createElement("td");0===r?(u.contentEditable=!1,1<e&&(a=document.createElement("span"),c=document.createElement("div"),d=document.createElement("button"),s=document.createElement("div"),i=document.createElement("p"),o=document.createElement("p"),l=document.createElement("p"),c.setAttribute("class","dropdown"),d.id="hy-dropbtn-"+e+"-"+w.table_Id,d.className="dropbtn",s.id="hy-dropdown-"+e+"-"+w.table_Id,s.className="dropdown-content",i.className="row-insert-top",i.textContent="Insert row above",o.className="row-insert-bottom",o.textContent="Insert row below",l.className="row-delete",l.textContent="Delete row",s.appendChild(i),s.appendChild(o),s.appendChild(l),c.appendChild(d),c.appendChild(s),u.appendChild(a),u.appendChild(c)),u.setAttribute("class","row-header")):1===r&&1===e?(u.contentEditable=!1,u.setAttribute("class","criterias")):u.contentEditable=!0,u.setAttribute("id","hr-"+e+"-"+r+"-"+w.table_Id),n.appendChild(u)}return n}(r,n))}function P(e,t){var n=j(),r=n[0].length,a=new Array(r).fill("");"top"===t&&n.splice(e,0,a),"bottom"===t&&n.splice(e+1,0,a),B(n),Cn(!1)}function F(e,t){for(var n=j(),r=n.length,a=0;a<r;a++)"left"===t&&n[a].splice(e,0,""),"right"===t&&n[a].splice(e+1,0,"");B(n),Cn(!1)}function z(e){var t,n,r;e.target!==e.currentTarget&&(e.target&&"TD"===e.target.nodeName&&(n=(t=e.target.id).split("-"),w.table_Id=""+n[3],(r=j())[n[1]][n[2]]=v(t),B(r)),e.stopPropagation())}function U(e){var t,n=e.target.id.split("-");"hr"===n[0]&&"1"===n[1]&&"1"===n[2]&&(w.table_Id=""+n[3],_("ht"+(t=n[3])).value=w.table_lookup[t],_("ht"+t).setAttribute("data-oldval",w.table_lookup[t]),en("hn"+t))}function q(e){var t,n,r=e.target.parentNode.id.split("-");w.table_Id=""+r[3],t=parseInt(r[2]),(n=j()).length<=3||(n.splice(t,1),B(n),Cn(!1))}function M(e){var t=e.target.parentNode.id.split("-");w.table_Id=""+t[3],function(e){var t,n=j(),r=n.length;if(!(n[0].length<=3)){for(t=0;t<r;t++)n[t].splice(e,1);B(n),Cn(!1)}}(parseInt(t[2]))}function H(e){var t,n,r,a="ht"+e,c=_(a).dataset.oldval,d=C(w.table_lookup,c),s=_(a).value;if(!0===(n=c,!0===(r=J(t=s))&&t===n&&(r=!1),r))return _(a).value="",void g("g");w.table_lookup[d]=s,w.table_Id=""+s,_(a).dataset.oldval="",_("hr-1-1-"+d).textContent=s,K(e)}function K(e){Xt("hn"+e),_("ht"+e).value=""}function W(e){w.table_Id=""+e[1],window.mscConfirm({title:"",subtitle:"This will reset all data in this section! Are you sure?",cancelText:"Exit",onOk:function(){var e,t;e=w.table_Id,t=!1,w.tableObj[e]=A(),Cn(t)},onCancel:function(){}})}function G(o){w.table_Id=""+o[1],window.mscConfirm({title:"",subtitle:"This will delete all data in this section! Are you sure?",cancelText:"Exit",onOk:function(){var e,t,n,r,a,c,d,s,i;e=o[1],t=_("table-headers-"+e).parentNode,n=_("table-body-"+e),r=_("table-headers-"+e),a=_("hs-"+e),c=_("hd-"+e),d=_("hk-"+e),s=_("hz-"+e),i=_("hn"+e),w.table_Id="",n.removeEventListener("focusout",z),n.removeEventListener("click",dn),r.removeEventListener("click",sn),a.removeEventListener("click",on),c.removeEventListener("click",c),d.removeEventListener("click",d),s.removeEventListener("click",s),L(t),t.parentNode.removeChild(t),a.parentNode.removeChild(a),c.parentNode.removeChild(c),d.parentNode.removeChild(d),s.parentNode.removeChild(s),i.parentNode.removeChild(i),delete w.tableObj[e],delete w.table_lookup[e]},onCancel:function(){}})}function V(e){var t,n,r;if(!e.target.matches(".dropbtn"))for(t=document.getElementsByClassName("dropdown-content"),r=0;r<t.length;r++)(n=t[r]).classList.contains("show")&&n.classList.remove("show")}function J(e){var t,n=Object.keys(w.tableObj),r=!1;if(n.length)for(t=0;t<n.length;t++)if(w.table_lookup[n[t]]===e){r=!0;break}return r}function Y(){var e,t=_("newRubrikSection").value,n=J(t),r=Object.keys(w.table_lookup),a=0<r.length?(e=r.length-1,r=r.sort(),"table"+(Number(r[e].substring(5))+1)):"table0";gn(w.table_lookup[a]=t,n)}function $(e){var t,n,r,a,c,d,s=Object.keys(w.tableObj),i={};for(i.rubricName=e,i.rubricDef=[],a=w.appEditRecords.loadedRubric.length-1;0<=a;a--)w.appEditRecords.loadedRubric[a].rubricName===e&&w.appEditRecords.loadedRubric.splice(a,1);for(a=0;a<s.length;a++){for((t={}).sectionName=w.table_lookup[s[a]],t.sectionDef=[],c=2;c<w.tableObj[s[a]].length;c++){for((n={}).criteriaName=w.tableObj[s[a]][c][1],n.criteriaDef=[],d=2;d<w.tableObj[s[a]][c].length;d++)(r={}).score=w.tableObj[s[a]][1][d],r.descriptor=w.tableObj[s[a]][c][d],n.criteriaDef.push(r);t.sectionDef.push(n)}i.rubricDef.push(t)}return i}function Z(){for(var e=Object.keys(w.tableObj),t=0;t<e.length;t++)vn(e[t]);L(_("rubrik")),w.tableObj={},w.table_Id="",w.table_lookup={},w.editorIsOpen.rubric=!1,Xt("ruNameCurrent"),_("ruNameNewtxt").value="",_("ruEnterNewName").value="",Xt("ruNewRubricName"),Xt("sectionInputWrapper"),Xt("rubricActions"),_("ac_ru_del").style.display="none",w.rubricsIndex.length&&en("ruLoadSelected"),en("ruCreateNew"),en("ruLoadChkBoxes")}function Q(){w.appEditRecords.loadedRubric.length&&en("ruLoadSelected"),Z()}function X(){for(var e,t,n,r,a,c,d=w.appEditRecords.loadedRubric[0],s=[],i=0;i<d.rubricDef.length;i++)s.push(d.rubricDef[i].sectionName);for(s=function(e){var t,n,r,a=function(e){var t,n={};for(t=0;t<e.length;t++)n.hasOwnProperty(e[t])?n[e[t]].push(t):e.lastIndexOf(e[t])!==t&&(n[e[t]]=[t]);return n}(e),c=Object.keys(a);for(n=0;n<c.length;n++)for(t=a[c[n]],r=0;r<t.length;r++)0<r&&(e[t[r]]=e[t[r]]+"("+r+")");return e}(s),i=0;i<d.rubricDef.length;i++)d.rubricDef[i].sectionName=s[i];for(w.tableObj={},i=0;i<d.rubricDef.length;i++)for(t=d.rubricDef[i].sectionDef.length+2,n=d.rubricDef[i].sectionDef[0].criteriaDef.length+2,r="table"+i,w.tableObj[r]=[],w.table_lookup[r]=d.rubricDef[i].sectionName,a=0;a<t;a++)e=new Array(n).fill(""),w.tableObj[r].push(e);for(i=0;i<d.rubricDef.length;i++)for(r=C(w.table_lookup,d.rubricDef[i].sectionName),t=d.rubricDef[i].sectionDef.length+2,n=d.rubricDef[i].sectionDef[0].criteriaDef.length+2,a=2;a<t;a++)for(w.tableObj[r][a][1]=d.rubricDef[i].sectionDef[a-2].criteriaName,c=2;c<n;c++)w.tableObj[r][1][c]=d.rubricDef[i].sectionDef[a-2].criteriaDef[c-2].score,w.tableObj[r][a][c]=d.rubricDef[i].sectionDef[a-2].criteriaDef[c-2].descriptor;return s}function ee(e,t){var n,r,a,c;if(L(_("ruLoadChkBoxes")),e.length)for(n=0;n<e.length;n++)yn(e[n],!0);if(t.length)for(r=_("ruLoadChkBoxes"),a=document.createDocumentFragment(),(c=document.createElement("DIV")).className="rubricsDivider",a.appendChild(c),r.appendChild(a),n=0;n<t.length;n++)yn(t[n],!1);en("ruLoadSelected")}function te(){_("shareThisRubric").checked=!1,ee(Object.keys(w.rubricsIndex),Object.keys(w.sharedRubricsIndex))}function ne(t,n){var r,e="assessments/"+firebase.auth().currentUser.uid+"/savedRubrics/"+t;""!==t&&null!=t?(!1===n&&(e="sharedRubrics/rubrics/"+t),firebase.database().ref(e).once("value").then(function(e){null!==(r=e.val())&&(w.appEditRecords.loadedRubric=[],w.appEditRecords.loadedRubric.push(r),w.appEditRecords.loadedRubric[0].rubricKey=t,!1===n&&(w.appEditRecords.loadedRubric[0].isFromShared=!0),function(){var e,t=[];for(en("ruNameCurrent"),_("ruNameNewtxt").value=w.appEditRecords.loadedRubric[0].rubricName,_("shareThisRubric").checked=!1,t=X(),e=0;e<t.length;e++)w.table_Id=""+t[e],function(e){gn(e,!1)}(t[e]);w.editorIsOpen.rubric=!0,Xt("ruLoadChkBoxes"),Xt("ruLoadSelected"),Xt("ruCreateNew"),en("sectionInputWrapper"),en("rubricActions"),_("ac_ru_del").style.display="block"}())},function(e){p(e)})):g("f")}function re(){for(var e,t,n=document.getElementsByName("scalor"),r=0;r<n.length;r++)if(n[r].checked){e=n[r].value,t=n[r].dataset.share;break}ne(e,!t)}function ae(e,t,n){w.rubricsIndex[e]=t,void 0!==n&&(w.sharedRubricsIndex[n]=t),w.appEditRecords.loadedRubric=[],Je(),te(),Z(),tn("editRubric"),g("e")}function ce(e){var t={rubricName:e.rubricName,sectionNames:[]};return t.sectionNames=e.rubricDef.map(function(e){return e.sectionName}),t}function de(){var r,a=firebase.auth().currentUser.uid,e=function(){var e,t,n,r,a,c="true",d=w.tableObj,s=Object.keys(d);if(""===_("ruNameNewtxt").value)return"Please give the rubric a name!";if(!s.length)return"Please add at least one section!";for(n=0;n<s.length;n++){if(""===s[n]){c="Please provide names for all sections!";break}if(d[e=s[n]].length<3){c="Please provide at least one criteria!";break}for(r=2;r<d[e].length;r++){if(d[s[n]][r].length<3){c="Please provide at least one score!";break}if(""===d[s[n]][r][1]){c="Please provide names for all criterias!";break}for(a=2;a<d[e][r].length;a++)if(""===d[e][1][a]||isNaN(d[e][1][a])){c="All scores are required and must be numerical!";break}if(t=D(d[e][1]),1!=d[e][1].length-t.length){c="Please ensure that the scores within each section are unique (no duplicate scores)!";break}}}return c}(),c=_("ruNameNewtxt").value;!1!==w.editorIsOpen.rubric&&("true"===e?(nn("editRubric"),null==w.appEditRecords.loadedRubric[0]||w.appEditRecords.loadedRubric[0].hasOwnProperty("isFromShared")&&!0===w.appEditRecords.loadedRubric[0].isFromShared?t(c,a):(r=w.appEditRecords.loadedRubric[0].rubricKey,window.mscConfirm({title:"",subtitle:"What would you like to do?",okText:"Update this rubric",cancelText:"Save as new rubric",onOk:function(){var e,t,n;e=c,t=r,n=a,!0===_("shareThisRubric").checked?window.mscConfirm({title:"",subtitle:"You have opted to share this rubric with all users. Is that correct?",cancelText:"Cancel",onOk:function(){d(e,t,n,!0)},onCancel:function(){}}):d(e,t,n,!1)},onCancel:function(){t(c+="-"+window.Date.now(),a)}}))):g("c",e))}function se(){window.mscConfirm({title:"Warning!",subtitle:"You are about to delete rubric: "+w.appEditRecords.loadedRubric[0].rubricName+"\nAre you sure?",cancelText:"Exit",onOk:function(){e(w.appEditRecords.loadedRubric[0].rubricKey)},onCancel:function(){}})}function S(e,t){var n=Number(x(_(e).value)),r=Number(x(_(t).value)),a=["",""];return NaN!==n&&NaN!==r&&(a[0]=""+n,a[1]=""+r),r<n&&(g("z"),a[0]="error"),a}function ie(e){return e.map(function(e){return e.sectionName})}function oe(){var e,t,n,r,a,c,d,s,i,o,l,u=Object.keys(w.rubricsIndex),p=u.length;if(Xt("gaLoading"),L(_("gaLoadChkBoxes")),t=_("gaLoadChkBoxes"),n=document.createDocumentFragment(),r=document.createElement("input"),a=document.createElement("label"),r.id="_sanz_rubrik",r.value="No rubric",r.name="scalot",r.type="radio",a.htmlFor="_sanz_rubrik",a.textContent="No rubric",n.appendChild(r),n.appendChild(a),t.appendChild(n),p){for(e=0;e<p;e++)c=u[e],d=w.rubricsIndex[u[e]].rubricName,l=o=i=s=void 0,s=_("gaLoadChkBoxes"),i=document.createDocumentFragment(),o=document.createElement("input"),l=document.createElement("label"),o.id="gr"+c,o.value=d,o.name="scalot",o.type="radio",l.htmlFor="gr"+c,l.textContent=d,i.appendChild(o),i.appendChild(l),s.appendChild(i);_("catsSet").addEventListener("click",Yt,{capture:!1,passive:!0}),_("ctxFe").addEventListener("click",Pt,{capture:!1,passive:!0}),_("ctxMte").addEventListener("click",Ft,{capture:!1,passive:!0}),_("ctxHw").addEventListener("click",zt,{capture:!1,passive:!0}),_("ctxAssgn").addEventListener("click",Ut,{capture:!1,passive:!0}),_("ctxOther").addEventListener("click",qt,{capture:!1,passive:!0}),_("gaCbContainer").addEventListener("click",_t,{capture:!1,passive:!0}),_("gaLoadChkBoxes").addEventListener("click",Gt,{capture:!1,passive:!0}),w.editorIsOpen.graderSetup=!0}}function le(){for(var e=w.grader.tempRecord.activeSections.length,t=ie(w.grader.rubricFilter).length,n=0;n<t;n++)_("gs"+n).textContent="";if(0<e)for(n=0;n<e;n++)_("gs"+w.grader.tempRecord.activeSections[n]).textContent=n+1}function ue(e){var t,n,r=_(e).selectedIndex-1,a=e.substring(2).split("-");3===a.length&&(a[0]=Number(a[0]),a[1]=Number(a[1]),-1!=(a[2]=r)?(n=a,w.grader.tempRecord.scores[n[0]][n[1]]=[],w.grader.tempRecord.scores[n[0]][n[1]]=n,t=w.grader.rubric[a[0]].sectionDef[a[1]].criteriaDef[r].descriptor,_("gf"+a[0]+"-"+a[1]+"-3").textContent=t):(w.grader.tempRecord.scores[a[0]][a[1]]=[],_("gf"+a[0]+"-"+a[1]+"-3").textContent=""))}function pe(){var e,t,n,r,a,c,d,s,i,o,l,u,p=w.grader.rubric.length;for(_("titleHeader").textContent=w.grader.tempRecord.context,function(){var e;L(_("datgEntry"));var t=document.createDocumentFragment();for(e=0;e<w.grader.rubric.length;e++){var n=document.createElement("div"),r=document.createElement("div"),a=document.createElement("div"),c=document.createElement("div"),d=document.createElement("div"),s=document.createElement("div"),i=document.createElement("div"),o=document.createElement("div"),l=document.createElement("div"),u=document.createElement("div"),p=document.createElement("div");n.className="row",r.className="col-lg-12 wrapTextPreline",r.id="gv"+e,c.className="row",d.className="col-lg-12 sectionLabel",d.textContent=w.grader.rubric[e].sectionName,s.id="gq"+e,s.className="row",i.className="row",o.className="col-lg-12",l.className="row",u.className="col-lg-12 text-center",p.id="gj"+e,p.className="btn btn-sm btn-primary commitBtn icon-lock-open",p.textContent="",i.appendChild(o),c.appendChild(d),a.appendChild(c),a.appendChild(i),a.appendChild(s),n.appendChild(r),a.appendChild(n),u.appendChild(p),l.appendChild(u),a.appendChild(l),t.appendChild(a)}_("datgEntry").appendChild(t)}(),e=0;e<p;e++)u=l=o=i=s=d=c=a=r=n=void 0,n=_("gq"+(t=e)),r=document.createDocumentFragment(),a=document.createElement("table"),c=document.createElement("thead"),d=document.createElement("tr"),s=document.createElement("th"),i=document.createElement("th"),o=document.createElement("th"),l=document.createElement("th"),u=document.createElement("tbody"),a.className="table table-condensed table-bordered",a.style.marginBottom="5px",c.className="text-center tableHeader",s.className="col-width120",s.textContent="Criteria",i.className="col-width50",i.textContent="Score",o.className="col-width50",o.textContent="Max.",l.className="col-lg-6 col-md-6 col-sm-6",l.textContent="Descriptor",u.id="gf"+t,d.appendChild(s),d.appendChild(i),d.appendChild(o),d.appendChild(l),c.appendChild(d),a.appendChild(c),a.appendChild(u),r.appendChild(a),n.appendChild(r);for(e=0;e<p;e++)!function(e){var t,n,r=_("gf"+e),a=document.createDocumentFragment(),c=w.grader.rubric[e].sectionDef,d=c.length,s=document.createElement("tr"),i=document.createElement("td"),o=document.createElement("td"),l=document.createElement("span");for(t=0;t<d;t++){var u=document.createElement("tr"),p=document.createElement("td"),m=document.createElement("td"),f=document.createElement("td"),b=document.createElement("td"),h="gf"+e+"-"+t+"-",g=document.createElement("div"),v=document.createElement("select"),C=c[t].criteriaDef.map(function(e){return e.score}).sort(function(e,t){return e<t}),E=C.length,x=C[E-1],R=document.createElement("option");for(p.id=h+"0",p.textContent=c[t].criteriaName,g.className="selectScore select-styleO",v.id=h+"1",R.value="",R.textContent="-",R.selected=!0,v.appendChild(R),n=0;n<E;n++){var N=document.createElement("option");N.value=C[n],N.textContent=C[n],v.appendChild(N)}f.id=h+"2",f.textContent=x,b.id=h+"3",b.textContent="",g.appendChild(v),m.appendChild(g),u.appendChild(p),u.appendChild(m),u.appendChild(f),u.appendChild(b),a.appendChild(u)}i.textContent="Comment:",l.id="gp"+e,l.className="icon-paste pasteBtn",o.id="gk"+e,o.contentEditable="true",o.textContent="",o.colSpan="3",i.appendChild(l),s.appendChild(i),s.appendChild(o),a.appendChild(s),r.appendChild(a)}(e)}function me(e){var t=_("txtCanvas"),n=t.getContext("2d");return n.font="30px Arial",n.fillText(e,0,30),t.toDataURL("image/png")}function fe(){var e=_("txtCanvas");e.getContext("2d").clearRect(0,0,e.width,e.height)}function be(){!0===ge()&&s(Ne())}function he(){var e,t,n,r;!0===ge()&&(e=function(){var e,t,n,r,a,c={},d=[0,0],s="",i=Date.now(),o=new Date(i).toLocaleDateString(),l=me(w.grader.tempRecord.ssId+" "+w.grader.tempRecord.ssName);if(c.styles={header:{fontSize:14,bold:!0,margin:[0,0,0,10]},subheader:{fontSize:12,bold:!0,margin:[0,10,0,5]},tableExample:{margin:[0,3,0,3]},tableHeader:{bold:!0,fontSize:13,color:"black"},smallerTxt:{fontSize:8}},c.defaultStyle={fontSize:11},c.pageSize="A4",c.content=[],c.pageBreakBefore=function(e,t){return 1===e.headlineLevel&&0===t.length},c.content.push({text:o,alignment:"left",fontSize:10,margin:[0,-10,0,1]}),c.content.push({columns:[{text:w.grader.tempRecord.context,alignment:"left",fontSize:14},{image:l,width:100,alignment:"right"}]}),!0===w.grader.noRubricCommentsOnly)""===(t=S("gOvrllScr","gOvrllMax"))[0]||""===t[1]&&"0"===t[1]||(s+=t[0]+"/"+t[1]);else{for(r=0;r<w.grader.tempRecord.scores.length;r++){for(a=n=0;a<w.grader.tempRecord.scores[r].length;a++)e=ve(r,a),0===n&&c.content.push({text:e.sectionName,fontSize:12,bold:!0,margin:[0,6,0,3]}),d[0]+=Number(e.score),d[1]+=Number(e.maxScore),c.content.push({text:e.criteria+": "+e.score+"/"+e.maxScore},{style:"tableExample",table:{widths:["*"],body:[[{border:[!1,!1,!1,!1],fillColor:"#eeeeee",text:e.descriptor,fontSize:10}]]},layout:{defaultBorder:!1}}),n++;var u;""!==w.grader.tempRecord.comments[r]&&(u=w.grader.tempRecord.comments[r],c.content.push({text:"Comment:"},{style:"tableExample",table:{widths:["*"],body:[[{border:[!1,!1,!1,!1],text:u,fontSize:10}]]},layout:{defaultBorder:!1}}))}s+=d[0]+"/"+d[1]}{var p;c.content.push({text:s,alignment:"right",fontSize:14,margin:[0,6,0,0]}),""!==w.grader.tempRecord.feedback.written&&(c.content.push({text:"General Feedback:",fontSize:12,bold:!0,margin:[0,6,0,3]}),""!==w.grader.tempRecord.feedback.written&&(p=w.grader.tempRecord.feedback.written,c.content.push({text:p,fontSize:11,margin:[0,0,0,3]})))}if(!0===document.getElementById("gRbChkd").checked)for(r=0;r<w.grader.rubric.length;r++)c.content.push(function(e){var t,n,r,a,c={pageBreak:"before",pageOrientation:"landscape",style:"smallerTxt",table:{headerRows:1,dontBreakRows:!0,keepWithHeaderRows:1,body:[]}},d=e.sectionDef.length,s=!0,i=!0,o=[];for(r=0;r<d;r++){for(n=e.sectionDef[r].criteriaDef.length,a=0;a<n;a++)!0===i&&(!0===s&&(o.push("RUBRIC\r\n"+e.sectionName),s=!1),o.push(e.sectionDef[r].criteriaDef[a].score));i=!1}for(c.table.body.push(o),r=0;r<d;r++){for(o=[],n=e.sectionDef[r].criteriaDef.length,t=!0,a=0;a<n;a++)!0===t&&(o.push(e.sectionDef[r].criteriaName),t=!1),o.push(e.sectionDef[r].criteriaDef[a].descriptor);c.table.body.push(o)}return c}(w.grader.rubric[r]));return fe(),c}(),t=k(w.grader.tempRecord.class),n=k(w.grader.tempRecord.ssId),r=k(w.grader.tempRecord.ssName),pdfMake.createPdf(e).download(t+"_"+r+"_"+n+"_"+w.grader.tempRecord.context+".pdf"),s(Ne()))}function ge(){var e,t=Re();return""===w.grader.tempRecord.ssId||""===w.grader.tempRecord.ssName?(g("t"),!1):(!0!==w.grader.noRubricCommentsOnly||"error"!==S("gOvrllScr","gOvrllMax")[0])&&(!0===t&&(e=v("gFbWritten"),w.grader.tempRecord.feedback.written=e,Xt("gradeActions"),!0))}function ve(e,t){var n,r,a=w.grader.tempRecord.scores[e][t][1],c=w.grader.tempRecord.scores[e][t][2],d={};return d.sectionIndex=w.grader.tempRecord.scores[e][t][0],d.sectionName=w.grader.rubric[d.sectionIndex].sectionName,d.criteria=w.grader.rubric[d.sectionIndex].sectionDef[a].criteriaName,d.score=w.grader.rubric[d.sectionIndex].sectionDef[a].criteriaDef[c].score,d.maxScore=(n=w.grader.rubric[d.sectionIndex].sectionDef[a].criteriaDef,(r=n.map(function(e){return e.score}).sort(function(e,t){return e-t}))[r.length-1]),d.descriptor=w.grader.rubric[d.sectionIndex].sectionDef[a].criteriaDef[c].descriptor,d}function Ce(e,t){var n,r;n=Number(e.substring(2)),r=v("gk"+n),w.grader.tempRecord.comments[n]=r,Xt("gq"+t),wt(t,!0),Dt(e,w.grader.tempRecord.sectionLocked[t]=!0)}function Ee(e,t){wt(t,!1),en("gq"+t),Dt(e,w.grader.tempRecord.sectionLocked[t]=!1)}function xe(e){var t=Number(e.substring(2)),n=function(e){for(var t=!0,n=0;n<w.grader.tempRecord.scores[e].length;n++)if(!w.grader.tempRecord.scores[e][n].length){t=!1;break}return t}(t),r=!1;!1===w.grader.tempRecord.sectionLocked[t]?!1===n?g("u"):(Ce(e,t),r=Re()):!0===w.grader.tempRecord.sectionLocked[t]&&Ee(e,t),It(r)}function Re(){for(var e=!0,t=0;t<w.grader.tempRecord.sectionLocked.length;t++)!1===w.grader.tempRecord.sectionLocked[t]&&(e=!1);return e}function Ne(){var e,t,n,r,a=_("gRbChkd").checked,c={};if(c.timeStamp=Date.now(),c.context=w.grader.tempRecord.context,c.feedback={},c.feedback.written=w.grader.tempRecord.feedback.written,c.feedback.rubric=w.grader.rubric,c.feedback.rubricChkd=a,c.studentData={},c.studentData.stCls=w.grader.tempRecord.class,c.studentData.stId=w.grader.tempRecord.ssId,c.studentData.stNme=w.grader.tempRecord.ssName,!0===w.grader.noRubricCommentsOnly)c.noRubric=!0,c.noRubricScore={},t=S("gOvrllScr","gOvrllMax"),c.noRubricScore.scr=t[0],c.noRubricScore.max=t[1];else for(c.comments=[],c.sectionNames=[],c.scores=[],c.sectionNames=w.grader.tempRecord.sectionNames,n=0;n<w.grader.tempRecord.scores.length;n++)for(c.comments.push(w.grader.tempRecord.comments[n]),c.scores.push([]),r=0;r<w.grader.tempRecord.scores[n].length;r++)e=ve(n,r),c.scores[n].push([]),c.scores[n][r].push(e.criteria),c.scores[n][r].push(e.score),c.scores[n][r].push(e.maxScore),c.scores[n][r].push(e.descriptor);return c}function ke(){return D(w.studentData.map(function(e){return e.stCls})).sort(function(e,t){return e-t})}function Se(t){var e=w.studentData.filter(function(e){return e.stCls===t}).map(function(e){return[e.stId,e.stNme]});return e.sort(function(e,t){return e[1].localeCompare(t[1])}),e}function ye(t,n,r){return w.recordsIndex.filter(function(e){return e.stId===t&&e.stNme===n&&e.stCls===r})||[]}function De(e){Xt("candidateInfo"),Xt("recordsContainer"),Xt("ac_re_update"),Xt("ac_re_exit"),Xt("editRecordActions"),en("mapContainer"),null!==_(e)&&_(e).scrollIntoView({behavior:"smooth",block:"center"})}function Ie(){var e="jk"+w.appEditRecords.tempStudentRecords[0].recordKey;Le(),L(_("recordsContainer")),w.appEditRecords.tempStudentRecords=[],w.appEditRecords.tempStudent.stId="",w.appEditRecords.tempStudent.stNme="",w.appEditRecords.tempStudent.Clss="",w.editorIsOpen.record=!1,De(e)}function we(e,t){for(var n,r,a,c,d,s=_(e),i=[s.dataset.cls,s.dataset.sid,s.dataset.nme],o=!0,l=0;l<i.length;l++)if(void 0===i[l]||"null"===i[l]||""===i[l]){o=!1;break}!0===o&&(!0===t?(n=s.dataset.cls,r=s.dataset.sid,a=s.dataset.nme,c=_("thisClass"),d=_("thisStudent"),w.appEditRecords.tempStudent.stId=r,w.appEditRecords.tempStudent.stNme=a,w.appEditRecords.tempStudent.Clss=n,c.value=w.appEditRecords.tempStudent.Clss,d.textContent=w.appEditRecords.tempStudent.stId+" "+w.appEditRecords.tempStudent.stNme,Xt("mapContainer"),en("candidateInfo"),en("recordsContainer"),en("ac_re_update"),en("editRecordActions"),en("ac_re_exit"),function(){var e,r,t,a=0,c=firebase.auth().currentUser.uid;if(""!==w.appEditRecords.tempStudent.stId&&""!==w.appEditRecords.tempStudent.stNme&&""!==w.appEditRecords.tempStudent.Clss){if(!(e=ye(w.appEditRecords.tempStudent.stId,w.appEditRecords.tempStudent.stNme,w.appEditRecords.tempStudent.Clss)).length)return _("recordsContainer").textContent="No records exist for this student!",Xt("ac_re_update"),Xt("ac_re_exit"),Rn();if(w.appEditRecords.tempStudentRecords=[],t=e.filter(function(e){return!0===_("jk"+e.recordKey).checked}),0===(r=t.length))return De(),g("p");t.forEach(function(n){firebase.database().ref("assessments/"+c+"/records/"+n.recordKey).once("value").then(function(e){var t=e.val();null!==t&&(t.recordKey=n.recordKey,w.appEditRecords.tempStudentRecords.push(t)),++a===r&&function(){var e,t=w.appEditRecords.tempStudentRecords.length;if(!t)return;for(L(_("recordsContainer")),en("candidateInfo"),e=0;e<t;e++)!function(e){var t,n,r,a,c=w.appEditRecords.tempStudentRecords[e];if(c.hasOwnProperty("noRubric")&&!0===c.noRubric)return function(e){var t=_("recordsContainer"),n=document.createDocumentFragment(),r=document.createElement("div"),a=document.createElement("div"),c=document.createElement("div"),d=document.createElement("div"),s=document.createElement("div"),i=document.createElement("div"),o=document.createElement("div"),l=document.createElement("div"),u=document.createElement("div"),p=document.createElement("div"),m=document.createElement("div"),f=document.createElement("div"),b=document.createElement("input"),h=document.createElement("input"),g=document.createElement("span"),v=document.createElement("input"),C=document.createElement("span"),E=document.createElement("span"),x=new Date(w.appEditRecords.tempStudentRecords[e].timeStamp).toLocaleString(),R=document.createElement("span"),N=document.createElement("div"),k=document.createElement("div"),S=document.createElement("div"),y=document.createElement("div");p.className="col-lg-3 col-md-3 col-sm-3 col-xs-6 fbkSection",m.className="feedbackLabel text-center",m.textContent="Score",f.className="text-center",b.type="number",b.id="ts"+e,b.className="genTotalScore",b.value=w.appEditRecords.tempStudentRecords[e].noRubricScore.scr,g.textContent=" / ",h.type="number",h.id="tm"+e,h.className="genTotalScore",h.value=w.appEditRecords.tempStudentRecords[e].noRubricScore.max,r.id="fh"+e,r.className="row",a.className="col-lg-12 recordWrapper",c.className="row",d.className="col-lg-12",s.id="fuSection"+e,i.className="row",i.style.marginLeft=0,i.style.marginRight=0,o.className="col-lg-9 col-md-9 col-sm-9 fbkSection",l.className="feedbackLabel",l.textContent="General feedback",u.id="opt1_"+e,u.contentEditable="true",u.className="fbkA commentBtnA",v.id="fc"+e,v.className="inputContext",v.value=w.appEditRecords.tempStudentRecords[e].context,C.textContent=x,C.className="btn-xs pull-right",E.id="fx"+e+"-0",E.className="btn btn-xs btn-dangerous pull-right destroyRecord",E.textContent="Delete Record",N.id="fq"+e,N.className="row nodisplay",k.className="col-lg-12 recordWrapper",S.className="row text-center",S.style.marginBottom="5px",S.textContent="Rubric for "+w.appEditRecords.tempStudentRecords[e].context+" - "+x+" ",y.id="frrA"+e,y.className="row small",R.id="fw"+e,R.className="btn btn-sm btn-default",R.textContent="Back to record",f.appendChild(b),f.appendChild(g),f.appendChild(h),o.appendChild(l),o.appendChild(u),p.appendChild(m),p.appendChild(f),i.appendChild(o),i.appendChild(p),d.appendChild(v),d.appendChild(E),d.appendChild(C),c.appendChild(d),a.appendChild(c),a.appendChild(s),a.appendChild(i),r.appendChild(a),n.appendChild(r),S.appendChild(R),k.appendChild(S),k.appendChild(y),N.appendChild(k),n.appendChild(N),t.appendChild(n),Te(e)}(e);for(function(e){var t=_("recordsContainer"),n=document.createDocumentFragment(),r=document.createElement("div"),a=document.createElement("div"),c=document.createElement("div"),d=document.createElement("div"),s=document.createElement("div"),i=document.createElement("div"),o=document.createElement("div"),l=document.createElement("div"),u=document.createElement("div"),p=document.createElement("div"),m=document.createElement("div"),f=document.createElement("div"),b=document.createElement("input"),h=document.createElement("span"),g=document.createElement("span"),v=new Date(w.appEditRecords.tempStudentRecords[e].timeStamp).toLocaleString(),C=document.createElement("div"),E=document.createElement("div"),x=document.createElement("label"),R=document.createElement("input"),N=document.createElement("span"),k=document.createElement("span"),S=document.createElement("div"),y=document.createElement("div"),D=document.createElement("div"),I=document.createElement("div");p.className="col-lg-3 col-md-3 col-sm-3 col-xs-6 fbkSection",m.className="feedbackLabel text-center",m.textContent="Rubric",f.className="text-center",C.className="squaredFour",C.style.display="inline-block",R.type="checkbox",R.id="opt2_"+e,R.value="nada",R.checked=w.appEditRecords.tempStudentRecords[e].feedback.rubricChkd,x.htmlFor="opt2_"+e,N.className="small",N.textContent="Include",E.id="fv"+e,E.className="small btn btn-sm btn-default rubricViewer",E.style.marginLeft="10px",E.textContent="View rubric",C.appendChild(R),C.appendChild(x),f.appendChild(C),f.appendChild(N),f.appendChild(E),r.id="fh"+e,r.className="row",a.className="col-lg-12 recordWrapper",c.className="row",d.className="col-lg-12",s.id="fuSection"+e,i.className="row",i.style.marginLeft=0,i.style.marginRight=0,o.className="col-lg-9 col-md-9 col-sm-9 fbkSection",l.className="feedbackLabel",l.textContent="General feedback",u.id="opt1_"+e,u.contentEditable="true",u.className="fbkA commentBtnA",b.id="fc"+e,b.className="inputContext",b.value=w.appEditRecords.tempStudentRecords[e].context,h.textContent=v,h.className="btn-xs pull-right",g.id="fx"+e+"-0",g.className="btn btn-xs btn-dangerous pull-right destroyRecord",g.textContent="Delete Record",S.id="fq"+e,S.className="row nodisplay",y.className="col-lg-12 recordWrapper",D.className="row text-center",D.style.marginBottom="5px",D.textContent="Rubric for "+w.appEditRecords.tempStudentRecords[e].context+" - "+v+" ",I.id="frrA"+e,I.className="row small",k.id="fw"+e,k.className="btn btn-sm btn-default",k.textContent="Back to record",o.appendChild(l),o.appendChild(u),p.appendChild(m),p.appendChild(f),i.appendChild(o),i.appendChild(p),d.appendChild(b),d.appendChild(g),d.appendChild(h),c.appendChild(d),a.appendChild(c),a.appendChild(s),a.appendChild(i),r.appendChild(a),n.appendChild(r),D.appendChild(k),y.appendChild(D),y.appendChild(I),S.appendChild(y),n.appendChild(S),t.appendChild(n),Te(e),function(e){var t,n,r,a,c,d,s,i,o,l,u=w.appEditRecords.tempStudentRecords[e],p=_("frrA"+e),m=document.createDocumentFragment();if(L(p),u.hasOwnProperty("noRubric")&&!0===u.noRubric)return;for(t=u.feedback.rubric,n=t.length,c=0;c<n;c++){var f=document.createElement("table"),b=document.createElement("thead"),h=document.createElement("tr"),g=document.createElement("tbody");for(f.className="table table-responsive table-striped table-bordered table-condensed",r=t[c].sectionDef.length,o=i=!0,d=0;d<r;d++){for(a=t[c].sectionDef[d].criteriaDef.length,s=0;s<a;s++){var v,C=document.createElement("th");!0===o&&(!0===i&&((v=document.createElement("th")).textContent=t[c].sectionName,h.appendChild(v),i=!1),C.textContent=t[c].sectionDef[d].criteriaDef[s].score,h.appendChild(C))}o=!1}for(b.appendChild(h),d=0;d<r;d++){var E=document.createElement("tr");for(a=t[c].sectionDef[d].criteriaDef.length,l=!0,s=0;s<a;s++){var x,R=document.createElement("td");!0===l&&((x=document.createElement("td")).textContent=t[c].sectionDef[d].criteriaName,E.appendChild(x),l=!1),R.textContent=t[c].sectionDef[d].criteriaDef[s].descriptor,E.appendChild(R)}g.appendChild(E)}f.appendChild(b),f.appendChild(g),m.appendChild(f)}p.appendChild(m)}(e)}(e),t=c.sectionNames,n=t.length,a=0;a<n;a++)r=t[a],function(e,t,n){var r=_("fuSection"+e),a=document.createDocumentFragment(),c=document.createElement("div"),d=document.createElement("div"),s=document.createElement("span"),i=document.createElement("input"),o=document.createElement("table"),l=document.createElement("thead"),u=document.createElement("tr"),p=document.createElement("th"),m=document.createElement("th"),f=document.createElement("th"),b=document.createElement("th"),h=document.createElement("tbody");c.id="fu"+e+"-"+n,c.style.marginBottom="10px",d.style.marginBottom="5px",s.textContent="Section: ",i.id="opt4_"+e+"_"+n,i.className="finalRecordSection",i.value=t,o.className="table table-condensed table-bordered",o.style.marginBottom="5px",l.className="text-center tableHeader",p.className="col-width120",p.textContent="Criteria",m.className="col-width50",m.textContent="Score",f.className="col-width50",f.textContent="Max.",b.className="col-lg-6 col-md-6 col-sm-6",b.textContent="Descriptor",h.id="ff"+e+"-"+n,d.appendChild(s),d.appendChild(i),u.appendChild(p),u.appendChild(m),u.appendChild(f),u.appendChild(b),l.appendChild(u),o.appendChild(l),o.appendChild(h),c.appendChild(d),c.appendChild(o),a.appendChild(c),r.appendChild(a)}(e,r,a),function(e,t){var n,r,a=_("ff"+e+"-"+t),c=document.createDocumentFragment(),d=w.appEditRecords.tempStudentRecords[e].scores[t],s=d.length,i=document.createElement("tr"),o=document.createElement("td"),l=document.createElement("td");for(n=0;n<s;n++){var u=document.createElement("tr"),p=document.createElement("td"),m=document.createElement("td"),f=document.createElement("td"),b=document.createElement("td"),h="ff"+e+"-"+t+"-"+n+"-",g=document.createElement("div"),v=document.createElement("select"),C=w.appEditRecords.tempStudentRecords[e].feedback.rubric[t].sectionDef[n].criteriaDef.map(function(e){return e.score}),E=C.length;for(p.textContent=d[n][0],g.className="selectScore select-styleO",v.id=h+"1",r=0;r<E;r++){var x=document.createElement("option");x.value=C[r],x.textContent=C[r],C[r]===d[n][1]&&(x.selected=!0),v.appendChild(x)}f.textContent=d[n][2],b.id=h+"3",b.textContent=d[n][3],g.appendChild(v),m.appendChild(g),u.appendChild(p),u.appendChild(m),u.appendChild(f),u.appendChild(b),c.appendChild(u)}o.textContent="Comment:",l.id="opt3_"+e+"_"+t,l.contentEditable="true",l.textContent=w.appEditRecords.tempStudentRecords[e].comments[t],l.colSpan="3",i.appendChild(o),i.appendChild(l),c.appendChild(i),a.appendChild(c)}(e,a)}(e);w.editorIsOpen.record=!0}()},function(e){p(e)})})}}()):function(e,t,n){var r,a,c,d=_("chooseClass"),s=_("chooseId");for(c=0;c<d.options.length;c++)if(d.options[c].value===e){d.options[c].selected=!0;break}for(Nn(e,!0),c=0;c<s.options.length;c++)if(r=s.options[c].value,a=s.options[c].dataset.nme,r===t&&a===n){s.options[c].selected=!0;break}jt(),Xt("mapgcontainer"),en("userInput")}(s.dataset.cls,s.dataset.sid,s.dataset.nme))}function _e(e){var t,n,r,a,c,d,s,i;if(e.target!==e.currentTarget){switch(e.target.id.substring(0,2)){case"jy":we(e.target.id,!0);break;case"jq":_("jb"+e.target.id.substring(2)).querySelectorAll("span.label.label-md").forEach(function(e){Oe(e.id)});break;case"jw":Oe(e.target.id);break;case"jh":s=e.target.id,(_("jm"+(i=s.substring(2))).classList.contains("nodisplay")?function(e){_("jh"+e).className=_("jh"+e).className.replace(/(?:^|\s)collpsd(?!\S)/g,""),en("jm"+e),en("jq"+e),en("jz"+e),en("jx"+e)}:function(e){_("jh"+e).className+=" collpsd",Xt("jm"+e),Xt("jq"+e),Xt("jz"+e),Xt("jx"+e)})(i);break;case"jx":a=e.target.id,c=_("jb"+a.substring(2)).querySelectorAll("input.targeted"),d=[],c.forEach(function(e){!0===e.checked&&d.push(e.id.substring(2))}),d.length&&(_(a).className+=" invisible",1!==d.length?u(d,a):l(d[0],a));break;case"jz":t=e.target.id,n=_("jb"+t.substring(2)).querySelectorAll("input.targeted"),r=[],n.forEach(function(e){!0===e.checked&&r.push(e.id.substring(2))}),r.length&&window.mscConfirm({title:"",subtitle:"This will permanently delete the selected records from this class! Are you sure?",cancelText:"Exit",onOk:function(){o(r)},onCancel:function(){}});break;default:return}e.stopPropagation()}}function Le(){_("recordsMap").querySelectorAll("input.targeted").forEach(function(e){_(e.id).dataset.slct="none",_(e.id).checked=!1})}function Oe(t){var n=_(t).dataset.slct,e=_(t).parentElement.parentElement;null!=e&&null!==e&&e.querySelectorAll("input.targeted").forEach(function(e){"all"===n&&(_(t).dataset.slct="none",!0!==_(e.id).checked&&(_(e.id).checked=!0)),"none"===n&&!(_(t).dataset.slct="all")!==_(e.id).checked&&(_(e.id).checked=!1)})}function Ae(t){var e=w.recordsIndex.filter(function(e){return e.stCls===t}).map(function(e){return[e.stId,e.stNme]});return e.sort(function(e,t){return e[1].localeCompare(t[1])}),e=function(e,t){for(var n,r=[],a=e.length,c=0;c<a;c++){for(n=c+1;n<a;n++)e[c][t]===e[n][t]&&(n=++c);r.push(e[c])}return r}(e,0)}function je(t){var n;return null!==t&&!R(t)&&(Object.keys(t).forEach(function(e){(n={}).recordKey=e,n.context=t[e].context,n.stCls=t[e].studentData.stCls,n.stId=t[e].studentData.stId,n.stNme=t[e].studentData.stNme,n.timeStamp=t[e].timeStamp,w.recordsIndex.push(n)}),!0)}function Be(){L(_("recordsContainer")),Rn(),De(),w.recordsIndex.length?_("recordsHeader").textContent="":_("recordsHeader").textContent="No records!",en("recordsContainer")}function Te(e){_("opt1_"+e).textContent=w.appEditRecords.tempStudentRecords[e].feedback.written}function Pe(){var e,t,n,r,a,c,d,s,i,o,l,u,p,m,f,b;if(w.appEditRecords.tempStudentRecords.length)if(""!==_("thisClass").value){for(e=w.appEditRecords.tempStudentRecords.length,c=a=r=n="ok",o=0;o<e;o++)if(!(t=w.appEditRecords.tempStudentRecords[o]).hasOwnProperty("null_marked_for_deletion"))if(t.hasOwnProperty("noRubric")&&!0===t.noRubric){if("error"===(c=S("ts"+o,"tm"+o)[0]))break;c="ok"}else{if(""===_("fc"+o).value){a="All grading contexts MUST be defined!";break}for(d=t.scores.length,i=[],l=0;l<d&&(b=void 0,b="ok",""===_("opt4_"+o+"_"+l||"").value&&(b="Please check the names of each section."),"ok"===(n=b));l++){for(s=t.scores[l].length,u=0;u<s&&"ok"===(r=function(e,t,n){var r="ff"+e+"-"+t+"-"+n+"-",a=_(r+"1").options[_(r+"1").selectedIndex].value,c="ok";""===x(a)&&(c="Please check all scores.");return c}(o,l,u));u++);i.push(_("opt4_"+o+"_"+l).value||"")}if(p=t.sectionNames,f=void 0,f="ok",m=D(m=i),p.length!==m.length&&(f="Please check that the names of each section are unique."),"ok"!==(n=f))break}"ok"!==a||"ok"!==n||"ok"!==r||"ok"!==c?"ok"===a?"ok"===n?"ok"===r||g("c",r):g("c",n):g("c",a):function(){var e,t,n,r,a,c,d,s=w.appEditRecords.tempStudentRecords.length;if(0===s)return;for(a=0;a<s;a++)if(!(n=w.appEditRecords.tempStudentRecords[a]).hasOwnProperty("null_marked_for_deletion"))if(_("thisClass").value!==w.appEditRecords.tempStudent.Clss&&(n.studentData.stCls=_("thisClass").value),n.context=_("fc"+a).value,n.feedback.written=v("opt1_"+a),n.hasOwnProperty("noRubric")&&!0===n.noRubric)n.noRubric=!0,n.noRubricScore={},r=S("ts"+a,"tm"+a),n.noRubricScore.scr=r[0],n.noRubricScore.max=r[1],n.feedback.rubricChkd=!1;else for(n.feedback.rubricChkd=_("opt2_"+a).checked,e=n.scores.length,c=0;c<e;c++)for(n.comments[c]=v("opt3_"+a+"_"+c),n.sectionNames[c]=_("opt4_"+a+"_"+c).value,t=n.scores[c].length,d=0;d<t;d++){var i="ff"+a+"-"+c+"-"+d+"-";n.scores[c][d][1]=_(i+"1").options[_(i+"1").selectedIndex].value,n.scores[c][d][3]=_(i+"3").textContent}h()}()}else g("q")}function Fe(e){var t,n,r,a,c=Qt(e.substring(2),"-");2===c.length&&0===c[0]&&(n=_("fh"+(t=c)[0]),r=w.appEditRecords.tempStudentRecords[t[0]],a=new Date(r.timeStamp).toLocaleString(),r.null_marked_for_deletion=!0,L(n),n.className+=" delPending",n.textContent=r.context+" "+a)}function ze(e){var t,n;switch(e.substring(0,2)){case"fx":Fe(e);break;case"fv":Xt("fh"+(n=e.substring(2))),en("fq"+n);break;case"fw":en("fh"+(t=e.substring(2))),Xt("fq"+t);break;default:return}}function Ue(e){var t,n,r,a;e.target!==e.currentTarget&&("SELECT"===e.target.nodeName&&(t=e.target.id,null!=(a=_(t).selectedIndex)&&(r=Qt(t.substring(2),"-"),n=w.appEditRecords.tempStudentRecords[r[0]].feedback.rubric[r[1]].sectionDef[r[2]].criteriaDef[a].descriptor,_("ff"+r[0]+"-"+r[1]+"-"+r[2]+"-3").textContent=n)),e.stopPropagation())}function qe(e){var t;e.target!==e.currentTarget&&("SELECT"!==e.target.nodeName&&("LABEL"===e.target.nodeName?"opt5_"===(t=e.target.id).substring(0,5)&&(w.appEditRecords.labelIndex=Number(t.substring(5))):ze(e.target.id)),e.stopPropagation())}function Me(e){var t,n,r,a=w.snippets.map(function(e){return e.snippetRubric});if(a.length)for(n=0;n<a.length;n++)for(t=w.snippets[n].snippetDef,r=0;r<t.length;r++)!0===e&&xn(n,r,t[r].snippet),He(n,r),Ke(n,r);else Ge()}function He(e,t){var n,r,a=_("iu"+e+"-"+t),c=document.createDocumentFragment(),d=Object.keys(w.rubricsIndex).map(function(e){return w.rubricsIndex[e].rubricName});for(d.unshift("any"),-1===(n=(d=D(d)).indexOf(w.snippets[e].snippetRubric))&&(w.snippets[e].snippetRubric="any",n=0),r=0;r<d.length;r++){var s=document.createElement("option");s.value=d[r],s.textContent=d[r],c.appendChild(s)}L(a),a.appendChild(c),a.options[n].setAttribute("selected",!0)}function Ke(e,t){var n,r=_("ia"+e+"-"+t),a=document.createDocumentFragment(),c=[],d=-1,s=Object.keys(w.rubricsIndex),i=s.map(function(e){return w.rubricsIndex[e].rubricName}).indexOf(w.snippets[e].snippetRubric);for(-1!==i&&(c=w.rubricsIndex[s[i]].sectionNames),c.unshift("any"),-1===(d=(c=D(c)).indexOf(w.snippets[e].snippetDef[t].section))&&(w.snippets[e].snippetDef[t].section="any",d=0),n=0;n<c.length;n++){var o=document.createElement("option");o.value=c[n],o.textContent=c[n],a.appendChild(o)}L(r),r.appendChild(a),r.options[d].setAttribute("selected",!0)}function We(e){for(var t=-1,n=w.snippets.length,r=0;r<n;r++)if(w.snippets[r].snippetRubric===e){t=r;break}return t}function Ge(){var e,t,n={},r=We("any");n.section="any",n.snippet="",-1===r&&(t={snippetRubric:"any",snippetDef:[]},w.snippets.push(t),r=w.snippets.length-1),w.snippets[r].snippetDef.push(n),xn(r,e=w.snippets[r].snippetDef.length-1,""),He(r,e),Ke(r,e)}function Ve(e){var t=Qt(e.substring(2),"-");!function(e,t){var n,r=t[0],a=t[1],c=_(e).options[_(e).selectedIndex].value,d=_("ia"+r+"-"+a),s=document.createDocumentFragment(),i=[],o=-1,l=Object.keys(w.rubricsIndex),u=l.map(function(e){return w.rubricsIndex[e].rubricName}).indexOf(c);-1!==u&&(i=w.rubricsIndex[l[u]].sectionNames);i.unshift("any"),i=D(i),-1===(o=i.indexOf(w.snippets[r].snippetDef[a].section))&&(w.snippets[r].snippetDef[a].section="any",o=0);for(n=0;n<i.length;n++){var p=document.createElement("option");p.value=i[n],p.textContent=i[n],s.appendChild(p)}L(d),d.appendChild(s),d.options[o].setAttribute("selected",!0)}(e,t)}function Je(){Me(!1)}function Ye(){w.snippets.length?w.snptSNAPSHOT=JSON.stringify(w.snippets):w.snptSNAPSHOT="",Me(!0)}function $e(){var e,t,n;if(w.hasOwnProperty("snptSNAPSHOT")&&""!==w.snptSNAPSHOT&&(w.snippets=JSON.parse(w.snptSNAPSHOT)),w.snippets.length){for(t=0;t<w.snippets.length;t++)for(n=w.snippets[t].snippetDef.length-1;0<=n;n--)""!==(e=w.snippets[t].snippetDef[n].snippet)&&"null_placeholder_for_new_snippet"!==e||w.snippets[t].snippetDef.splice(n,1);for(t=w.snippets.length-1;0<=t;t--)w.snippets[t].snippetDef.length||w.snippets.splice(t,1)}Ze()}function Ze(){L(_("snptsTbd")),Ye()}function Qe(){var e;w.snippets.length&&!0===function(){var e,t,n,r,a,c,d,s=[],i=_("snptsTbd").querySelectorAll("tr");if(nn("snippetsContainer"),w.snippets=[],i.forEach(function(e){n=e.id.substring(2),(r={}).rubric=_("iu"+n).options[_("iu"+n).selectedIndex].value,r.section=_("ia"+n).options[_("ia"+n).selectedIndex].value,r.content=v("ix"+n),""!==r.content&&s.push(r)}),!s.length)return tn("snippetsContainer"),!0;for(t=D(t=s.map(function(e){return e.rubric})),d=0;d<t.length;d++)(a={}).snippetRubric=t[d],a.snippetDef=[],w.snippets.push(a);for(d=0;d<s.length;d++)c=We(s[d].rubric),(e={}).section=s[d].section,e.snippet=s[d].content,w.snippets[c].snippetDef.push(e);return tn("snippetsContainer"),!0}()&&(e=firebase.auth().currentUser.uid,firebase.database().ref("assessments/"+e+"/snippets").set(w.snippets,function(e){return e?(p(e),void g("a",e)):(Ze(),void g("b"))}))}function Xe(e){var t,n;e.target!==e.currentTarget&&"LABEL"!==e.target.nodeName&&"ie"===(t=e.target.id).substring(0,2)&&(Xt("ii"+(n=t.substring(2))),_("ix"+n).textContent=""),e.stopPropagation()}function et(e){var t;!w.grader.snippets.length||1===w.grader.snippets.length&&""===w.grader.snippets[0].snippet?g("v"):("gFbWritten"!==e?(t=e.substring(2),w.grader.tempRecord.tempCommentElement="gk"+t):w.grader.tempRecord.tempCommentElement=e,Xt("userInput"),en("viewgSnppts"))}function tt(){et("gFbWritten")}function nt(e){var t,n,r=_("gx"+e).textContent;t=r,""!==(n=w.grader.tempRecord.tempCommentElement)&&(_(n).textContent+=" "+t)}function rt(e){var t;if(!0===e){var n=w.grader.rubric.map(function(e){return e.sectionName}),r=w.grader.tempRecord.tempSelectedSnippets,a=r.length;for(-1===n.indexOf("any")&&n.unshift("any"),t=0;t<a;t++)nt(r[t])}!function(){var e;for(w.grader.snippets=w.grader.snippets.sort(function(e,t){return e.snippet.localeCompare(t.snippet)}),L(_("snpptgContainer")),e=0;e<w.grader.snippets.length;e++)!function(e,t){var n=_("snpptgContainer"),r=document.createDocumentFragment(),a=document.createElement("div"),c=document.createElement("div"),d=document.createElement("tr"),s=document.createElement("td"),i=document.createElement("td"),o=document.createElement("td"),l=document.createElement("span"),u=document.createElement("input"),p=document.createElement("label"),m=document.createElement("span");s.className="text-center",l.id="gn"+e,l.className="helperNum",c.className="squaredFour snpptChkbx",u.type="checkbox",u.id="gc"+e,p.htmlFor="gc"+e,i.className="text-center",m.id="gt"+e,m.className="small",o.id="gx"+e,o.textContent=t,c.appendChild(u),c.appendChild(p),a.appendChild(l),a.appendChild(c),s.appendChild(a),i.appendChild(m),d.appendChild(s),d.appendChild(i),d.appendChild(o),r.appendChild(d),n.appendChild(r),function(e){var t,n,r=_("gt"+e),a=["any"],c=w.grader.tempRecord.sectionNames,d=c.length;for(n=0;n<d;n++)a.push(c[n]);-1!==(t=a.indexOf(w.grader.snippets[e].section))&&(r.textContent=a[t])}(e)}(e,w.grader.snippets[e].snippet)}()}function at(e){var t,n=-1;if(w.grader.snippets.length)for(t=0;t<w.grader.snippets.length;t++)if(w.grader.snippets[t].snippetRubric===e){n=t;break}return n}function ct(){var e;w.grader.snippets=w.snippets.slice(0),!0!==w.grader.noRubricCommentsOnly?w.grader.snippets.length&&(e=function(){var e,t,n,r,a=at(w.grader.tempRecord.rubricRef),c=at("any"),d=[];if(-1!==a){if(-1!==c)return;for(r=w.grader.snippets[a].snippetDef.length-1;0<=r;r--)d.push(w.grader.snippets[a].snippetDef[r])}if(-1!==c)for(r=w.grader.snippets[c].snippetDef.length-1;0<=r;r--)d.unshift(w.grader.snippets[c].snippetDef[r]);return e=w.grader.rubric.map(function(e){return e.sectionName}),t=e.map(function(n){return d.filter(function(e,t){return-1!==d[t].section.indexOf(n)})}).reduce(function(e,t){return e.concat(t)}),n=d.filter(function(e){return"any"===e.section}),t.concat(n)}(),w.grader.snippets=e,rt(!1)):rt(!1)}function dt(){Ht(!1)}function st(){Ht(!0)}function it(){var e;w.studentData.length&&(e=ut(w.studentData),w.studentData=e),function(e){var t,n=w.studentData.length;if(L(_("editStudents_body")),!0===e){if(0===n)return mt();for(t=0;t<n-1;t++)En(t,w.studentData[t]),w.studentData[t].stCls!==w.studentData[t+1].stCls&&lt();En(n-1,w.studentData[n-1]),lt()}}(!0)}function ot(e){var t,n,r,a,c,d,s=e.target.files[0];if("csv"!==s.name.substring(s.name.length-3))return g("m"),void document.getElementById("nputStudents").reset();window.Papa.parse(s,{header:!0,worker:!0,dynamicTyping:!1,encoding:"",skipEmptyLines:!0,complete:function(e){if(document.getElementById("nputStudents").reset(),e.data.length){for(t=Object.keys(e.data[0]),n=t.length,r=["class","id","name"],a=[],c=0;c<3;c++)for(d=0;d<n;d++)if(t[c].toLocaleLowerCase===r[c]){a.push(""+r[c]);break}3===a.length?function(e,t){var n,r=results.data.length;for(w.csvStudentData=[],n=0;n<r;n++)e[n].stCls=b(e[n][t[0]]),e[n].stId=b(e[n][t[1]]),e[n].stNme=b(e[n][t[2]]),w.csvStudentData.push(e[n]);!function(){var e,t=_("editStudents_body").childNodes.length,n=w.csvStudentData.length;w.csvStudentData=ut(w.csvStudentData),0===n&&L(_("editStudents_body"));for(e=0;e<n-1;e++)En(t+e,w.csvStudentData[e]),w.csvStudentData[e].stCls!==w.csvStudentData[e+1].stCls&&lt();En(t+(n-1),w.csvStudentData[n-1]),lt(),w.csvStudentData=[]}()}(e.data,a):g("l")}}})}function lt(){var e=document.getElementById("editStudents_body"),t=document.createDocumentFragment(),n=document.createElement("div");n.className="col-lg-12",n.style.height="50px",t.appendChild(n),e.appendChild(t)}function ut(e){return e.sort(function(e,t){return e.stCls.localeCompare(t.stCls)||e.stNme.localeCompare(t.stNme)}),e}function pt(e){var t;e.target!==e.currentTarget&&("yd"===e.target.id.substring(0,2)&&(Xt("yt"+(t=e.target.id.substring(2))),_("yc"+t).value="",_("yf"+t).value="",_("yn"+t).value=""),e.stopPropagation())}function mt(){var e,t={stCls:"",stId:"",stNme:""};w.studentData.push(t),En(e=w.studentData.length-1,w.studentData[e]),_("yt"+e).scrollIntoView({behavior:"smooth",block:"center"})}function ft(){for(var e,t=w.studentData.length-1;0<=t;t--)""===(e=w.studentData[t]).stCls&&""===e.stId&&""===e.stNme&&w.studentData.splice(t,1);it()}function bt(){var e,t,n=[],r=_("editStudents_body").childNodes;for(var a in r)"TR"===r[a].nodeName&&n.push(r[a].id.substring(2));n.length?(e=function(e){for(var t,n,r,a=!0,c=0;c<e.length;c++)if(t=f(_("yc"+e[c]).value),n=f(_("yf"+e[c]).value),r=f(_("yn"+e[c]).value),""===t||""===n||""===r){if(""!==t||""!==n||""!==r){a=!1;break}_("yf"+e[c]).value="marked_null_for_deletion"}return a}(n),t=function(e){for(var t,n,r,a=!0,c=[],d=0;d<e.length;d++)t=N(_("yf"+e[d]).value),n=N(_("yc"+e[d]).value),"marked_null_for_deletion"!==t?(r=""+n+t,c.push(r)):(t="marked_null_for_deletion_"+d,c.push(t));return D(c).length!==c.length&&(a=!1),a}(n),!1!==e?!1!==t?(ht(n),it()):g("j"):g("k")):ht(n)}function ht(e){var t,n,r,a=e.length;for(w.studentData=[],n=0;n<a;n++)t={},"marked_null_for_deletion"!==_("yf"+e[n]).value&&(t.stCls=N(_("yc"+e[n]).value),t.stId=N(_("yf"+e[n]).value),t.stNme=N(_("yn"+e[n]).value),w.studentData.push(t));r=firebase.auth().currentUser.uid,firebase.database().ref("assessments/"+r+"/studentData").set(w.studentData,function(e){return e?(p(e),void g("a",e)):void g("i")})}function gt(){_("editStudents_body").querySelectorAll("input").forEach(function(e){e.value=""})}function vt(){var e;null!==(e=_("mainMenu").querySelector("div.btn-primary.active"))&&(e.className=e.className.replace(/(?:^|\s)active(?!\S)/g,"")),!0===w.editorIsOpen.grader&&Wt(!1),Xt("mapContainer"),Xt("editRubric"),Xt("editFinalRecord"),Xt("editStudents"),Xt("editSnippets"),Xt("components"),Xt("editRecordActions"),Xt("rubricActions"),Xt("snippetActions"),Xt("studentActions"),Xt("gradeActions")}function Ct(){var e;!1===w.db.records&&(e=firebase.auth().currentUser.uid,firebase.database().ref("assessments/"+e+"/recordsIndex").once("value").then(function(e){var t=je(e.val());!(w.db.records=!0)===t&&(w.recordsIndex=[]),Be(),fn()},function(e){p(e)})),_("titleHeader").textContent="Records",en("editFinalRecord"),!0===w.editorIsOpen.record?en("editRecordActions"):en("mapContainer")}function Et(){var t;!1===w.db.rubrics&&(t=firebase.auth().currentUser.uid,firebase.database().ref("sharedRubrics/rubricsIndex").once("value").then(function(e){w.sharedRubricsIndex=e.val()||{},firebase.database().ref("assessments/"+t+"/savedRubricsIndex").once("value").then(function(e){w.rubricsIndex=e.val()||{},w.db.rubrics=!0,R(w.rubricsIndex)||(en("ruLoadSelected"),te()),pn()},function(e){p(e)})},function(e){p(e)})),_("titleHeader").textContent="Rubrics",en("editRubric"),!0===w.editorIsOpen.rubric&&en("rubricActions")}function xt(){var e;!1===w.db.students&&(e=firebase.auth().currentUser.uid,firebase.database().ref("assessments/"+e+"/studentData").once("value").then(function(e){w.studentData=e.val()||[],w.db.students=!0,it(),mn()},function(e){p(e)})),_("titleHeader").textContent="Current students",en("editStudents"),en("studentActions")}function Rt(){_("titleHeader").textContent="Grade",Xt("gaSctnBoxes"),(!1===w.db.rubrics||!1===w.db.students||!1===w.db.snippets?function(){var e;if(!1===w.db.rubrics)e=firebase.auth().currentUser.uid,firebase.database().ref("assessments/"+e+"/savedRubricsIndex").once("value").then(function(e){w.db.rubrics=!0,w.rubricsIndex=e.val()||{},!1===w.db.snippets&&a(),R(w.rubricsIndex)||(en("gaLoadChkBoxes"),te()),pn(),r()},function(e){p(e)});else{if(!1===w.db.students)return r();rn()}}:rn)()}function Nt(e){switch(vt(),_(e).className+=" active",e){case"leRecords":Ct();break;case"leStudents":xt();break;case"leRubrics":Et();break;case"leSnippets":!1===w.db.snippets&&a(),_("titleHeader").textContent="Comment snippets",en("editSnippets"),en("snippetActions");break;case"leGRADER":Rt();break;case"leSignout":vt(),c();break;default:return}}function kt(e){e.target!==e.currentTarget&&("SPAN"===e.target.nodeName?Nt(e.target.parentElement.id):"DIV"===e.target.nodeName&&Nt(e.target.id),e.stopPropagation())}function St(e){switch(e.substring(0,2)){case"gj":xe(e);break;case"gp":et(e);break;case"gc":!function(e){var t,n,r=_(e).checked,a=e.substring(2);for(!0===r?w.grader.tempRecord.tempSelectedSnippets.push(a):-1!==(t=w.grader.tempRecord.tempSelectedSnippets.indexOf(a))&&w.grader.tempRecord.tempSelectedSnippets.splice(t,1),n=0;n<w.grader.snippets.length;n++)_("gn"+n).textContent="";for(n=0;n<w.grader.tempRecord.tempSelectedSnippets.length;n++)_("gn"+w.grader.tempRecord.tempSelectedSnippets[n]).textContent=n+1}(e);break;default:return}}function yt(e){e.target!==e.currentTarget&&("SELECT"!==e.target.nodeName&&St(e.target.id),e.stopPropagation())}function Dt(e,t){!0===t?(_(e).className=_(e).className.replace(/(?:^|\s)icon-lock-open(?!\S)/g,""),_(e).className+=" icon-lock"):(_(e).className=_(e).className.replace(/(?:^|\s)icon-lock(?!\S)/g,""),_(e).className+=" icon-lock-open")}function It(e){(!0!==e?Xt:en)("gradeActions")}function wt(e,t){var n="",r=w.grader.tempRecord.scores[e];if(!0===t){for(var a=r.length-1,c=0;c<=a;c++)n+=w.grader.rubric[e].sectionDef[r[c][1]].criteriaName+" "+w.grader.rubric[e].sectionDef[r[c][1]].criteriaDef[r[c][2]].score+":\r\n - "+w.grader.rubric[e].sectionDef[r[c][1]].criteriaDef[r[c][2]].descriptor+"\r\n";""!==w.grader.tempRecord.comments[e]&&(n+="\r\nComment:\r\n - "+w.grader.tempRecord.comments[e]+"\r\n"),_("gv"+e).textContent=n,en("gv"+e)}else Xt("gv"+e)}function _t(e){var t,n,r,a;e.target!==e.currentTarget&&("INPUT"===e.target.nodeName&&(t=e.target.id,n=_(t),r=Number(n.value),!0===(a=n.checked)?function(e){var t=ie(w.grader.rubricFilter);""!==e&&"undefined"!==e&&-1===w.grader.tempRecord.activeSections.indexOf(e)&&"undefined"!==t[e]&&w.grader.tempRecord.activeSections.push(e),le()}(r):!1===a&&function(e){var t=w.grader.tempRecord.activeSections.indexOf(e);-1!==t&&w.grader.tempRecord.activeSections.splice(t,1),le()}(r)),e.stopPropagation())}function Lt(){Xt("userInput"),en("mapgcontainer")}function Ot(e){var t,n,r;e.target!==e.currentTarget&&("gy"===(t=e.target.id.substring(0,2))?we(e.target.id,!1):"gh"===t&&(n=e.target.id,_(r="gb"+n.substring(2)).classList.contains("nodisplay")?(_(n).className=_(n).className.replace(/(?:^|\s)collpsd(?!\S)/g,""),en(r)):(_(n).className+=" collpsd",Xt(r))),e.stopPropagation())}function At(){var e=_("chooseClass"),t=_("select-styleB"),n=e.options[e.selectedIndex].value;""!==n&&(Nn(n,!1),t.className=t.className.replace(/(?:^|\s)invisible(?!\S)/g,""))}function jt(){var e=_("chooseClass"),t=_("chooseId");w.grader.tempRecord.class=e.options[e.selectedIndex].value,w.grader.tempRecord.ssId=t.options[t.selectedIndex].value,w.grader.tempRecord.ssName=t.options[t.selectedIndex].dataset.nme,_("thisgClass").textContent=w.grader.tempRecord.class,_("thisgStudent").textContent=w.grader.tempRecord.ssId+" "+w.grader.tempRecord.ssName,Xt("studentgSlct"),en("studentgInfo")}function Bt(){var e=_("chooseId"),t=_("select-styleB");!0===e.hasChildNodes("option")&&(e.options[0].selected=!0),w.grader.tempRecord.ssId="",w.grader.tempRecord.ssName="",t.className=t.className.replace(/(?:^|\s)invisible(?!\S)/g,""),_("gOvrllScr").value="",Xt("studentgInfo"),en("studentgSlct")}function Tt(e){w.grader.tempRecord.context=e,Xt("ctxContent"),_("ctxContent").value=""}function Pt(){Tt("Final Exam")}function Ft(){Tt("Midterm Exam")}function zt(){Tt("Homework")}function Ut(){Tt("Assignment")}function qt(){w.grader.tempRecord.context=_("ctxContent").value,en("ctxContent")}function Mt(e){"LABEL"!==e.target.nodeName&&St(e.target.id),e.stopPropagation()}function Ht(e){Xt("viewgSnppts"),rt(e),en("userInput"),w.grader.tempRecord.tempSelectedSnippets=[]}function Kt(){Wt(!0)}function Wt(e){w.grader.rubric=[],w.grader.loadedRubric=[],w.grader.tempRecord.activeSections=[],w.grader.noRubricCommentsOnly=!1,Bt(),Ut(),_("ctxAssgn").checked=!0,_("gOvrllScr").value="",_("gOvrllMax").value="",_("gFbWritten").textContent="",Xt("gaSctnBoxes"),Xt("userInput"),Xt("viewgSnppts"),Xt("mapgcontainer"),Xt("gradeActions"),Xt("components"),_("select-styleB").className+=" invisible",!0===w.editorIsOpen.grader&&(_("datgEntry").removeEventListener("change",Jt,{capture:!1,passive:!0}),_("datgEntry").removeEventListener("click",yt,{capture:!1,passive:!0}),_("chooseClass").removeEventListener("change",At,{capture:!1,passive:!0}),_("chooseId").removeEventListener("change",jt,{capture:!1,passive:!0}),_("resetStudent").removeEventListener("click",Bt,{capture:!1,passive:!0}),_("ac_gr_save").removeEventListener("click",be,{capture:!1,passive:!0}),_("ac_gr_dl").removeEventListener("click",he,{capture:!1,passive:!0}),_("mgap").removeEventListener("click",Ot,{capture:!1,passive:!0}),_("showgMap").removeEventListener("click",Lt,{capture:!1,passive:!0}),_("snpptgContainer").removeEventListener("click",Mt,{capture:!1,passive:!0}),_("textApaste").removeEventListener("click",tt,{capture:!1,passive:!0}),_("snpptgSave").removeEventListener("click",st,{capture:!1,passive:!0}),_("snpptgExit").removeEventListener("click",dt,{capture:!1,passive:!0}),_("resetGrader").removeEventListener("click",Kt,{capture:!1,passive:!0}),_("userInput").removeEventListener("paste",E,!1),_("gaRbAttchd").removeEventListener("click",$t,{capture:!1,passive:!0}),_("closeGaRbAttchd").removeEventListener("click",Zt,{capture:!1,passive:!0}),w.editorIsOpen.grader=!1),!0===w.editorIsOpen.graderSetup&&(bn(),w.editorIsOpen.graderSetup=!1),L(_("gaCbContainer")),!0===e&&(_("titleHeader").textContent="Grade",rn())}function Gt(e){if(e.target!==e.currentTarget){if("INPUT"===e.target.nodeName){if("_sanz_rubrik"===e.target.id)return w.grader.noRubricCommentsOnly=!0,w.grader.loadedRubric=[],Vt(null),void an();var t=e.target.id.substring(2);n=t,r=firebase.auth().currentUser.uid,firebase.database().ref("assessments/"+r+"/savedRubrics/"+n).once("value").then(function(e){w.grader.loadedRubric=[],w.grader.loadedRubric.push(e.val()),Vt(n),an()},function(e){p(e),g("y",e)})}e.stopPropagation()}var n,r}function Vt(e){if(Xt("gaSctnBoxes"),w.grader.tempRecord.activeSections=[],!0===_("_sanz_rubrik").checked)return kn(!1),void en("gaSctnBoxes");!0===_("gr"+e).checked&&(w.grader.noRubricCommentsOnly=!1,w.grader.rubricFilter=[],w.grader.rubricFilter=JSON.parse(JSON.stringify(w.grader.loadedRubric[0].rubricDef)),w.grader.tempRecord.rubricRef=""+w.grader.loadedRubric[0].rubricName,kn(!0),en("gaSctnBoxes"))}function Jt(e){e.target!==e.currentTarget&&("SELECT"===e.target.nodeName&&ue(e.target.id),e.stopPropagation())}function Yt(){!0==(""!==_("ctxContent").value&&!0===_("ctxOther").checked&&(w.grader.tempRecord.context=_("ctxContent").value),""===w.grader.tempRecord.context?(g("w"),!1):!0===w.grader.noRubricCommentsOnly||0!==w.grader.tempRecord.activeSections.length||(g("x"),!1))&&(w.editorIsOpen.grader=!0,w.editorIsOpen.graderSetup=!1,w.grader.rubric=[],en("viewRubricDuringGrading"),Xt("viewNoRubricOverallScore"),!0===w.grader.noRubricCommentsOnly&&(_("gRbChkd").checked=!1,Xt("viewRubricDuringGrading"),en("viewNoRubricOverallScore"),It(!0)),w.grader.rubric=function(){for(var e=[],t=0;t<w.grader.tempRecord.activeSections.length;t++)e.push(w.grader.rubricFilter[w.grader.tempRecord.activeSections[t]]);return e}(),function(){var e;for(w.grader.tempRecord.ssId="",w.grader.tempRecord.ssName="",w.grader.tempRecord.class="",w.grader.tempRecord.scores=[],w.grader.tempRecord.comments=[],w.grader.tempRecord.feedback={},w.grader.tempRecord.feedback.written="",w.grader.tempRecord.sectionLocked=[],w.grader.tempRecord.tempCommentElement="",w.grader.tempRecord.tempSelectedSnippets=[],w.grader.tempRecord.sectionNames=[],e=0;e<w.grader.rubric.length;e++){w.grader.tempRecord.sectionNames.push(w.grader.rubric[e].sectionName),w.grader.tempRecord.scores.push([]),w.grader.tempRecord.comments.push(""),w.grader.tempRecord.sectionLocked.push(!1);for(var t=w.grader.rubric[e].sectionDef.map(function(e){return e.criteriaName}),n=0;n<t.length;n++)w.grader.tempRecord.scores[e].push([])}delete w.grader.rubricFilter,delete w.grader.tempRecord.activeSections}(),pe(),bn(),_("datgEntry").addEventListener("change",Jt,{capture:!1,passive:!0}),_("datgEntry").addEventListener("click",yt,{capture:!1,passive:!0}),_("chooseClass").addEventListener("change",At,{capture:!1,passive:!0}),_("chooseId").addEventListener("change",jt,{capture:!1,passive:!0}),_("resetStudent").addEventListener("click",Bt,{capture:!1,passive:!0}),_("ac_gr_save").addEventListener("click",be,{capture:!1,passive:!0}),_("ac_gr_dl").addEventListener("click",he,{capture:!1,passive:!0}),_("mgap").addEventListener("click",Ot,{capture:!1,passive:!0}),_("showgMap").addEventListener("click",Lt,{capture:!1,passive:!0}),_("snpptgContainer").addEventListener("click",Mt,{capture:!1,passive:!0}),_("textApaste").addEventListener("click",tt,{capture:!1,passive:!0}),_("snpptgSave").addEventListener("click",st,{capture:!1,passive:!0}),_("snpptgExit").addEventListener("click",dt,{capture:!1,passive:!0}),_("resetGrader").addEventListener("click",Kt,{capture:!1,passive:!0}),_("userInput").addEventListener("paste",E,!1),_("gaRbAttchd").addEventListener("click",$t,{capture:!1,passive:!0}),_("closeGaRbAttchd").addEventListener("click",Zt,{capture:!1,passive:!0}),ct(),Xt("components"),en("userInput"),function(){var e,t,n,r,a,c,d,s,i=w.grader.rubric.length,o=_("gaFullRbContainer"),l=document.createDocumentFragment();for(L(o),n=0;n<i;n++){var u=document.createElement("table"),p=document.createElement("thead"),m=document.createElement("tr"),f=document.createElement("tbody");for(u.className="table table-responsive table-striped table-bordered table-condensed",e=w.grader.rubric[n].sectionDef.length,d=c=!0,r=0;r<e;r++){for(t=w.grader.rubric[n].sectionDef[r].criteriaDef.length,a=0;a<t;a++){var b,h=document.createElement("th");!0===d&&(!0===c&&((b=document.createElement("th")).textContent=w.grader.rubric[n].sectionName,m.appendChild(b),c=!1),h.textContent=w.grader.rubric[n].sectionDef[r].criteriaDef[a].score,m.appendChild(h))}d=!1}for(p.appendChild(m),r=0;r<e;r++){var g=document.createElement("tr");for(t=w.grader.rubric[n].sectionDef[r].criteriaDef.length,s=!0,a=0;a<t;a++){var v,C=document.createElement("td");!0===s&&((v=document.createElement("td")).textContent=w.grader.rubric[n].sectionDef[r].criteriaName,g.appendChild(v),s=!1),C.textContent=w.grader.rubric[n].sectionDef[r].criteriaDef[a].descriptor,g.appendChild(C)}f.appendChild(g)}u.appendChild(p),u.appendChild(f),l.appendChild(u)}o.appendChild(l)}())}function $t(){Xt("userInput"),en("gaFullRb")}function Zt(){Xt("gaFullRb"),en("userInput")}function Qt(e,t){return e.split(t).map(function(e){return Number(e)})}function Xt(e){_(e).classList.contains("nodisplay")||(_(e).className+=" nodisplay")}function en(e){_(e).className=_(e).className.replace(/(?:^|\s)nodisplay(?!\S)/g,"")}function tn(e){_(e).className=_(e).className.replace(/(?:^|\s)disabledbutton(?!\S)/g,"")}function nn(e){_(e).className+=" disabledbutton",window.scrollTo(0,0)}function rn(){if(!1!==w.db.students){if(!w.studentData.length||1===w.studentData.length&&""===w.studentData[0].stCls)return Xt("components"),void g("c","No student data was found.");en("components"),en("gaLoading"),oe()}}function an(){!function(){var e,t,n,r=ke(),a=document.createDocumentFragment(),c=_("mgap");for(L(c),t=0;t<r.length;t++){var d=document.createElement("div"),s=document.createElement("div");for(d.id="gh"+t,d.textContent="Class: "+r[t],d.className="mapClass",e=Se(r[t]),n=0;n<e.length;n++){var i=document.createElement("div");i.id="gy"+t+"-"+n,i.dataset.cls=r[t],i.dataset.sid=e[n][0],i.dataset.nme=e[n][1],i.className="btn btn-sm btn-inline btn-default",i.style.margin="1px",i.textContent=e[n][0]+" "+e[n][1],s.appendChild(i)}s.id="gb"+t,a.appendChild(d),a.appendChild(s)}c.appendChild(a)}(),function(){var e,t=ke(),n=_("chooseClass"),r=document.createDocumentFragment(),a=document.createElement("option");for(a.value="",a.textContent="Class",r.appendChild(a),e=0;e<t.length;e++){var c=document.createElement("option");c.value=t[e],c.textContent=t[e],r.appendChild(c)}L(n),n.appendChild(r),n.firstChild.setAttribute("disabled",!0),n.firstChild.setAttribute("selected",!0)}()}function cn(e){Le(),_(e).className=_(e).className.replace(/(?:^|\s)invisible(?!\S)/g,"")}function dn(e){var t,n,r;if(e.target!==e.currentTarget)switch(e.target.className){case"criterias":U(e);break;case"dropbtn":r=e.target.id.split("-"),w.table_Id=""+r[3],_("hy-dropdown-"+r[2]+"-"+w.table_Id).classList.toggle("show");break;case"row-insert-top":n=e.target.parentNode.id.split("-"),w.table_Id=""+n[3],P(parseInt(n[2]),"top");break;case"row-insert-bottom":t=e.target.parentNode.id.split("-"),w.table_Id=""+t[3],P(parseInt(t[2]),"bottom");break;case"row-delete":q(e);break;default:return}}function sn(e){var t,n,r;if(e.target!==e.currentTarget)switch(e.target.className){case"dropbtn":r=e.target.id.split("-"),w.table_Id=""+r[3],_("hx-dropdown-"+r[2]+"-"+w.table_Id).classList.toggle("show");break;case"col-insert-left":n=e.target.parentNode.id.split("-"),w.table_Id=""+n[3],F(parseInt(n[2]),"left");break;case"col-insert-right":t=e.target.parentNode.id.split("-"),w.table_Id=""+t[3],F(parseInt(t[2]),"right");break;case"col-delete":M(e);break;default:return}}function on(e){var t,n,r=e.target.id.split("-");switch(r[0]){case"hk":n=r,w.table_Id=""+n[1],H(n[1]);break;case"hz":t=r,w.table_Id=""+t[1],K(t[1]);break;case"hs":W(r);break;case"hd":G(r);break;default:return}e.stopPropagation()}function ln(e){var t,n,r,a={},c=[0,0],d=new Date(e.timeStamp).toLocaleDateString(),s=me(e.studentData.stId+" "+e.studentData.stNme);for(a.styles={header:{fontSize:14,bold:!0,margin:[0,0,0,10]},subheader:{fontSize:12,bold:!0,margin:[0,10,0,5]},tableExample:{margin:[0,3,0,3]},tableHeader:{bold:!0,fontSize:13,color:"black"},smallerTxt:{fontSize:8}},a.defaultStyle={fontSize:11},a.pageSize="A4",a.content=[],a.pageBreakBefore=function(e,t){return 1===e.headlineLevel&&0===t.length},a.content.push({text:d,alignment:"left",fontSize:10,margin:[0,-10,0,1]}),a.content.push({columns:[{text:e.context,alignment:"left",fontSize:14},{image:s,width:100,alignment:"right"}]}),n=0;n<e.scores.length;n++){for(r=t=0;r<e.scores[n].length;r++){var i=e.scores[n][r][1],o=e.scores[n][r][2];0===t&&a.content.push({text:e.sectionNames[n],fontSize:12,bold:!0,margin:[0,6,0,3]}),c[0]+=Number(i),c[1]+=Number(o),""===e.scores[n][r][3]?a.content.push({text:e.scores[n][r][0]+": "+i+"/"+o},{style:"tableExample",table:{widths:["*"],body:[[{border:[!1,!1,!1,!1],text:"",fontSize:10}]]},layout:{defaultBorder:!1}}):a.content.push({text:e.scores[n][r][0]+": "+i+"/"+o},{style:"tableExample",table:{widths:["*"],body:[[{border:[!1,!1,!1,!1],fillColor:"#eeeeee",text:e.scores[n][r][3],fontSize:10}]]},layout:{defaultBorder:!1}}),t++}""!==e.comments[n]&&a.content.push({text:"Comment:"},{style:"tableExample",table:{widths:["*"],body:[[{border:[!1,!1,!1,!1],text:e.comments[n],fontSize:10}]]},layout:{defaultBorder:!1}})}if(a.content.push({text:c[0]+"/"+c[1],alignment:"right",fontSize:14,margin:[0,6,0,0]}),""!==e.feedback.written&&(a.content.push({text:"General Feedback:",fontSize:12,bold:!0,margin:[0,6,0,3]}),a.content.push({text:e.feedback.written,fontSize:11,margin:[0,0,0,3]})),!0===e.feedback.rubricChkd)for(n=0;n<e.feedback.rubric.length;n++)a.content.push(function(e){var t,n,r,a,c={pageBreak:"before",pageOrientation:"landscape",style:"smallerTxt",table:{headerRows:1,dontBreakRows:!0,keepWithHeaderRows:1,body:[]}},d=e.sectionDef.length,s=!0,i=!0,o=[];for(t=0;t<d;t++){for(a=e.sectionDef[t].criteriaDef.length,n=0;n<a;n++)!0===i&&(!0===s&&(o.push("RUBRIC\r\n"+e.sectionName),s=!1),o.push(e.sectionDef[t].criteriaDef[n].score));i=!1}for(c.table.body.push(o),t=0;t<d;t++){for(o=[],a=e.sectionDef[t].criteriaDef.length,r=!0,n=0;n<a;n++)!0===r&&(o.push(e.sectionDef[t].criteriaName),r=!1),o.push(e.sectionDef[t].criteriaDef[n].descriptor);c.table.body.push(o)}return c}(e.feedback.rubric[n]));return fe(),a}function un(){_("mainMenu").removeEventListener("click",un,{capture:!1,passive:!0}),L(_("welcomeMsg"))}function pn(){_("newRubrikSectionBtn").addEventListener("click",Y,{capture:!1,passive:!0}),_("editRubric").addEventListener("click",V,{capture:!1,passive:!0}),_("ruCreateNew").addEventListener("click",y,{capture:!1,passive:!0}),_("ac_ru_commit").addEventListener("click",de,{capture:!1,passive:!0}),_("ac_ru_dis").addEventListener("click",Q,{capture:!1,passive:!0}),_("ruLoadSelected").addEventListener("click",re,{capture:!1,passive:!0}),_("ac_ru_del").addEventListener("click",se,{capture:!1,passive:!0}),_("rubrik").addEventListener("paste",E,!1)}function mn(){_("ac_st_add").addEventListener("click",mt,{capture:!1,passive:!0}),_("ac_st_exit").addEventListener("click",ft,{capture:!1,passive:!0}),_("ac_st_save").addEventListener("click",bt,{capture:!1,passive:!0}),_("editStudents_table").addEventListener("click",pt,{capture:!1,passive:!0}),_("studentfile").addEventListener("change",ot,{capture:!1,passive:!0}),_("ac_st_reset").addEventListener("click",gt,{capture:!1,passive:!0}),_("editStudents_table").addEventListener("paste",E,!1)}function fn(){_("recordsContainer").addEventListener("change",Ue,{capture:!1,passive:!0}),_("recordsContainer").addEventListener("click",qe,{capture:!1,passive:!0}),_("ac_re_update").addEventListener("click",Pe,{capture:!1,passive:!0}),_("ac_re_exit").addEventListener("click",Ie,{capture:!1,passive:!0}),_("recordsMap").addEventListener("click",_e,{capture:!1,passive:!0}),_("showmap").addEventListener("click",Ie,{capture:!1,passive:!0}),_("recordsContainer").addEventListener("paste",E,!1)}function bn(){_("catsSet").removeEventListener("click",Yt,{capture:!1,passive:!0}),_("ctxFe").removeEventListener("click",Pt,{capture:!1,passive:!0}),_("ctxMte").removeEventListener("click",Ft,{capture:!1,passive:!0}),_("ctxHw").removeEventListener("click",zt,{capture:!1,passive:!0}),_("ctxAssgn").removeEventListener("click",Ut,{capture:!1,passive:!0}),_("ctxOther").removeEventListener("click",qt,{capture:!1,passive:!0}),_("gaCbContainer").removeEventListener("click",_t,{capture:!1,passive:!0}),_("gaLoadChkBoxes").removeEventListener("click",Gt,{capture:!1,passive:!0})}function hn(){Xt("ruNewRubricName"),_("ruNewSaveBtn").removeEventListener("click",I,{capture:!1,passive:!0}),_("ruNewExitBtn").removeEventListener("click",O,{capture:!1,passive:!0})}function gn(e,t){var n;!0!==t?(""!==e&&!1===t&&(function(e){w.tableObj.hasOwnProperty(e)||(w.tableObj[e]=[["","","","","","",""],["","","","","","",""],["","","","","","",""],["","","","","","",""],["","","","","","",""],["","","","","","",""]]),w.table_Id=""+e;var t=_("rubrik"),n=document.createDocumentFragment(),r=document.createElement("table"),a=document.createElement("thead"),c=document.createElement("tbody"),d=document.createElement("div"),s=document.createElement("div"),i=document.createElement("div"),o=document.createElement("input"),l=document.createElement("button"),u=document.createElement("button");i.id="hn"+e,i.className="sectionNameEdit nodisplay",o.id="ht"+e,o.dataset.oldval="",l.id="hk-"+e,l.className="btn btn-sm btn-whiteBlue",l.textContent="Rename section",u.id="hz-"+e,u.className="btn btn-sm btn-default",u.textContent="Cancel",r.className="spreadsheet__table",a.id="table-headers-"+e,a.className="spreadsheet__table--headers",c.className="spreadsheet__table--body",c.id="table-body-"+e,d.id="hs-"+e,d.className="btn btn-xs btn-blueYellow pull-right spreadSheetBtn",d.textContent="Reset section",s.id="hd-"+e,s.className="btn btn-xs btn-dangerous pull-right spreadSheetBtn",s.textContent="Delete section",i.appendChild(o),i.appendChild(l),i.appendChild(u),r.appendChild(a),r.appendChild(c),n.appendChild(i),n.appendChild(r),n.appendChild(s),n.appendChild(d),t.appendChild(n)}(n=C(w.table_lookup,e)),Cn(!0),_("hs-"+n).addEventListener("click",on),_("hd-"+n).addEventListener("click",on),_("hk-"+n).addEventListener("click",on),_("hz-"+n).addEventListener("click",on)),_("newRubrikSection").value=""):g("g")}function vn(e){var t=_("table-headers-"+e),n=_("table-body-"+e);null!==n&&(n.removeEventListener("focusout",z),n.removeEventListener("click",dn)),null!==t&&t.removeEventListener("click",sn)}function Cn(e){var t,n,r,a,c,d,s,i=""+w.table_Id;!1===e&&vn(i),n=(t=j()).length-1,r=t[0].length-1,a=_("table-headers-"+i),d=(c=_("table-body-"+i)).cloneNode(!0),c.parentNode.replaceChild(d,c),s=a.cloneNode(!0),a.parentNode.replaceChild(s,a),L(s),L(d),s.appendChild(function(e){var t,n=document.createElement("tr");for(n.setAttribute("id","hh-0-"+w.table_Id),t=0;t<=e;t++){var r,a,c,d,s,i,o,l=document.createElement("th");l.setAttribute("id","hb-0-"+t+"-"+w.table_Id),l.setAttribute("class",0===t?"":"column-header"),0!==t&&(r=document.createElement("span"),1<t&&(r.setAttribute("class","column-header-span"),a=document.createElement("div"),c=document.createElement("button"),d=document.createElement("div"),s=document.createElement("p"),i=document.createElement("p"),o=document.createElement("p"),a.setAttribute("class","dropdown"),c.id="hx-dropbtn-"+t+"-"+w.table_Id,c.className="dropbtn",d.id="hx-dropdown-"+t+"-"+w.table_Id,d.className="dropdown-content",s.className="col-insert-left",s.textContent="Insert column left",i.className="col-insert-right",i.textContent="Insert column right",o.className="col-delete",o.textContent="Delete column",d.appendChild(s),d.appendChild(i),d.appendChild(o),a.appendChild(c),a.appendChild(d),l.appendChild(r),l.appendChild(a))),n.appendChild(l)}return n}(r)),T(d,n,r),function(){var e,t,n=j();if(null!=n)for(e=1;e<n.length;e++)for(t=1;t<n[e].length;t++)_("hr-"+e+"-"+t+"-"+w.table_Id).textContent=n[e][t]}(),d.addEventListener("focusout",z),d.addEventListener("click",dn),s.addEventListener("click",sn),_("hr-1-1-"+w.table_Id).textContent=w.table_lookup[i]}function En(e,t){var n=document.getElementById("editStudents_body"),r=document.createDocumentFragment(),a=document.createElement("tr"),c=document.createElement("td"),d=document.createElement("td"),s=document.createElement("td"),i=document.createElement("td"),o=document.createElement("span"),l=document.createElement("input"),u=document.createElement("input"),p=document.createElement("input");c.className="col-lg-4 col-md-4 col-sm-4 col-xs-4",d.className="col-lg-4 col-md-4 col-sm-4 col-xs-4",s.className="col-lg-4 col-md-4 col-sm-4 col-xs-4",l.id="yc"+e,l.value=t.stCls,u.id="yf"+e,u.value=t.stId,p.id="yn"+e,p.value=t.stNme,i.className="col-width30 text-center",o.id="yd"+e,o.className="btn btn-xs btn-danger",o.textContent="✖",a.id="yt"+e,c.appendChild(l),d.appendChild(u),s.appendChild(p),i.appendChild(o),a.appendChild(c),a.appendChild(d),a.appendChild(s),a.appendChild(i),r.appendChild(a),n.appendChild(r)}function xn(e,t,n){var r=_("snptsTbd"),a=document.createDocumentFragment(),c=document.createElement("div"),d=document.createElement("div"),s=document.createElement("tr"),i=document.createElement("td"),o=document.createElement("td"),l=document.createElement("td"),u=document.createElement("td"),p=document.createElement("span"),m=document.createElement("select"),f=document.createElement("select"),b="iu"+e+"-"+t;s.id="ii"+e+"-"+t,i.className="text-center",c.className="selectSnippet select-styleO",m.id=b,m.onchange=function(){Ve(b)},o.className="text-center",d.className="selectSnippet select-styleO",f.id="ia"+e+"-"+t,l.id="ix"+e+"-"+t,l.contentEditable="true",l.textContent=n,u.className="col-width30 text-center",p.id="ie"+e+"-"+t,p.className="btn btn-xs btn-danger",p.textContent="✖",c.appendChild(m),i.appendChild(c),d.appendChild(f),o.appendChild(d),u.appendChild(p),s.appendChild(i),s.appendChild(o),s.appendChild(l),s.appendChild(u),a.appendChild(s),r.appendChild(a)}function Rn(){var e,t,n,r,a,c=D(w.recordsIndex.map(function(e){return e.stCls})).sort(function(e,t){return e-t}),d=document.createDocumentFragment(),s=_("recordsMap");for(L(s),n=0;n<c.length;n++){var i=document.createElement("div"),o=document.createElement("div"),l=document.createElement("table"),u=document.createElement("tbody"),p=document.createElement("span"),m=document.createElement("span"),f=document.createElement("span");for(p.id="jq"+n,p.className="label label-md",p.style.fontWeight=400,p.textContent="Select all / none",m.id="jz"+n,m.className="btn btn-xs btn-dangerous destroyRecord pull-right",m.style.marginLeft="5px",m.textContent="Delete selected",f.id="jx"+n,f.className="btn btn-xs btn-default pull-right",f.textContent="Download selected",f.style.paddingLeft="5px",f.style.paddingRight="5px",i.id="jh"+n,i.className="mapClass",i.textContent="Class: "+c[n]+" ",o.id="jm"+n,l.className="table small noBtmMargin",u.id="jb"+n,e=Ae(c[n]),r=0;r<e.length;r++){var b=document.createElement("tr"),h=document.createElement("td"),g=document.createElement("div");if(g.id="jy"+n+"-"+r,g.dataset.cls=c[n],g.dataset.sid=e[r][0],g.dataset.nme=e[r][1],g.className="btn btn-sm btn-whiteBlue",g.style.margin="1px",g.textContent="Edit",b.className="striped",h.appendChild(g),b.appendChild(h),(t=ye(e[r][0],e[r][1],c[n])).length){var v=document.createElement("td"),C=document.createElement("span");for(C.id="jw"+n+"-"+r,C.dataset.cls=c[n],C.dataset.sid=e[r][0],C.dataset.nme=e[r][1],C.className="label label-md",C.dataset.slct="all",C.textContent=e[r][0]+" "+e[r][1],v.className="tdSelectBtn",v.appendChild(C),b.appendChild(v),a=0;a<t.length;a++){var E=new Date(t[a].timeStamp).toLocaleDateString(),x=document.createElement("td"),R=document.createElement("div"),N=document.createElement("input"),k=document.createElement("label"),S=document.createElement("span"),y="jk"+t[a].recordKey;R.className="squaredFour compacted",N.type="checkbox",N.id=y,N.className="targeted",k.htmlFor=y,S.textContent=" "+t[a].context+"\n"+E,R.appendChild(N),R.appendChild(k),x.appendChild(R),x.appendChild(S),b.appendChild(x)}u.appendChild(b)}}i.appendChild(p),i.appendChild(m),i.appendChild(f),l.appendChild(u),o.appendChild(l),d.appendChild(i),d.appendChild(o)}s.appendChild(d)}function Ne(){var e,t,n,r,a=_("gRbChkd").checked,c={};if(c.timeStamp=Date.now(),c.context=w.grader.tempRecord.context,c.feedback={},c.feedback.written=w.grader.tempRecord.feedback.written,c.feedback.rubric=w.grader.rubric,c.feedback.rubricChkd=a,c.studentData={},c.studentData.stCls=w.grader.tempRecord.class,c.studentData.stId=w.grader.tempRecord.ssId,c.studentData.stNme=w.grader.tempRecord.ssName,!0===w.grader.noRubricCommentsOnly)c.noRubric=!0,c.noRubricScore={},t=S("gOvrllScr","gOvrllMax"),c.noRubricScore.scr=t[0],c.noRubricScore.max=t[1];else for(c.comments=[],c.sectionNames=[],c.scores=[],c.sectionNames=w.grader.tempRecord.sectionNames,n=0;n<w.grader.tempRecord.scores.length;n++)for(c.comments.push(w.grader.tempRecord.comments[n]),c.scores.push([]),r=0;r<w.grader.tempRecord.scores[n].length;r++)e=ve(n,r),c.scores[n].push([]),c.scores[n][r].push(e.criteria),c.scores[n][r].push(e.score),c.scores[n][r].push(e.maxScore),c.scores[n][r].push(e.descriptor);return c}function Nn(e,t){var n,r=Se(e),a=_("chooseId"),c=document.createDocumentFragment(),d=document.createElement("option");for(d.value="",d.dataset.nme="",d.textContent="Student",c.appendChild(d),n=0;n<r.length;n++){var s=document.createElement("option");s.value=r[n][0],s.dataset.nme=r[n][1],s.textContent=r[n][0]+" "+r[n][1],c.appendChild(s)}L(a),a.appendChild(c),a.firstChild.setAttribute("disabled",!0),!1===t&&a.firstChild.setAttribute("selected",!0)}function kn(e){var t,n,r;if(_("gaSctnTextHelper").textContent="",L(_("gaCbContainer")),!0===e){for(t=document.createDocumentFragment(),n=ie(w.grader.rubricFilter),r=0;r<n.length;r++){var a=document.createElement("div"),c=document.createElement("div"),d=document.createElement("div"),s=document.createElement("input"),i=document.createElement("label"),o=document.createElement("span");c.className="squaredFour",d.id="gs"+r,d.className="helperNum",s.type="checkbox",s.id="gw"+(r+1),s.value=r,s.checked=!1,i.htmlFor="gw"+(r+1),o.textContent=n[r],a.appendChild(d),c.appendChild(s),c.appendChild(i),a.appendChild(c),a.appendChild(o),t.appendChild(a)}_("gaSctnTextHelper").textContent="...and the sections to use (in order):",_("gaCbContainer").appendChild(t)}}function Sn(e,t){var n=_("welcomeMsg"),r=document.createDocumentFragment(),a=document.createElement("DIV"),c=document.createElement("DIV"),d=document.createElement("H2"),s=document.createElement("P");a.className="row contentBox",a.style.marginTop="80px",!(c.className="col-lg-12 text-left")===t&&(d.textContent="Access denied",s.textContent="Hello "+e+"! If you are known to us, access will be granted explicitly."),!0===t&&(d.textContent="Hello "+e,s.textContent="Please use the menu buttons to get started."),c.appendChild(d),c.appendChild(s),a.appendChild(c),r.appendChild(a),n.appendChild(r)}function yn(e,t){var n=_("ruLoadChkBoxes"),r=document.createDocumentFragment(),a=document.createElement("input"),c=document.createElement("label");a.id="ruSelect_"+e,a.value=e,a.name="scalor",a.type="radio",c.htmlFor="ruSelect_"+e,!0!==t?(a.dataset.share=!0,c.className="shared",c.textContent=w.sharedRubricsIndex[e].rubricName+" (shared)",c.style.color="#337ab7"):c.textContent=w.rubricsIndex[e].rubricName,r.appendChild(a),r.appendChild(c),n.appendChild(r)}firebase.auth().onAuthStateChanged(function(e){return e?(_("usrPhoto").src=e.photoURL,void m()):void(window.location="../index.html")})}()});